{"version":3,"file":"getPublishExpConfigAsync.js","names":["getPublishExpConfigAsync","projectRoot","options","releaseChannel","XDLError","exp","hooks","runtimeVersion","getConfig","skipSDKVersionRequirement","pkg","isPublicConfig","sdkVersion","Env","maySkipManifestValidation","locales","ExponentTools","getResolvedLocalesAsync"],"sources":["../../src/project/getPublishExpConfigAsync.ts"],"sourcesContent":["import {\n  ExpoAppManifest,\n  ExpoConfig,\n  getConfig,\n  PackageJSONConfig,\n  ProjectTarget,\n} from '@expo/config';\n\nimport { Env, ExponentTools, XDLError } from '../internal';\n\nexport type PublishOptions = {\n  releaseChannel?: string;\n  target?: ProjectTarget;\n  resetCache?: boolean;\n  maxWorkers?: number;\n  quiet?: boolean;\n};\n\nexport async function getPublishExpConfigAsync(\n  projectRoot: string,\n  options: Pick<PublishOptions, 'releaseChannel'> = {}\n): Promise<{\n  exp: ExpoAppManifest;\n  pkg: PackageJSONConfig;\n  hooks: ExpoConfig['hooks'];\n}> {\n  if (options.releaseChannel != null && typeof options.releaseChannel !== 'string') {\n    throw new XDLError('INVALID_OPTIONS', 'releaseChannel must be a string');\n  }\n  options.releaseChannel = options.releaseChannel || 'default';\n\n  // Verify that exp/app.json and package.json exist\n  const {\n    exp: { hooks, runtimeVersion },\n  } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  const { exp, pkg } = getConfig(projectRoot, {\n    isPublicConfig: true,\n    // enforce sdk validation if user is not using runtimeVersion\n    skipSDKVersionRequirement: !!runtimeVersion,\n  });\n  const { sdkVersion } = exp;\n  // Only allow projects to be published with UNVERSIONED if a correct token is set in env\n  if (sdkVersion === 'UNVERSIONED' && !Env.maySkipManifestValidation()) {\n    throw new XDLError('INVALID_OPTIONS', 'Cannot publish with sdkVersion UNVERSIONED.');\n  }\n  exp.locales = await ExponentTools.getResolvedLocalesAsync(projectRoot, exp);\n  return {\n    exp: {\n      ...exp,\n      sdkVersion: sdkVersion!,\n    },\n    pkg,\n    hooks,\n  };\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAQA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAUO,eAAeA,wBAAf,CACLC,WADK,EAELC,OAA+C,GAAG,EAF7C,EAOJ;EACD,IAAIA,OAAO,CAACC,cAAR,IAA0B,IAA1B,IAAkC,OAAOD,OAAO,CAACC,cAAf,KAAkC,QAAxE,EAAkF;IAChF,MAAM,KAAIC,oBAAJ,EAAa,iBAAb,EAAgC,iCAAhC,CAAN;EACD;;EACDF,OAAO,CAACC,cAAR,GAAyBD,OAAO,CAACC,cAAR,IAA0B,SAAnD,CAJC,CAMD;;EACA,MAAM;IACJE,GAAG,EAAE;MAAEC,KAAF;MAASC;IAAT;EADD,IAEF,IAAAC,mBAAA,EAAUP,WAAV,EAAuB;IAAEQ,yBAAyB,EAAE;EAA7B,CAAvB,CAFJ;EAGA,MAAM;IAAEJ,GAAF;IAAOK;EAAP,IAAe,IAAAF,mBAAA,EAAUP,WAAV,EAAuB;IAC1CU,cAAc,EAAE,IAD0B;IAE1C;IACAF,yBAAyB,EAAE,CAAC,CAACF;EAHa,CAAvB,CAArB;EAKA,MAAM;IAAEK;EAAF,IAAiBP,GAAvB,CAfC,CAgBD;;EACA,IAAIO,UAAU,KAAK,aAAf,IAAgC,CAACC,eAAA,CAAIC,yBAAJ,EAArC,EAAsE;IACpE,MAAM,KAAIV,oBAAJ,EAAa,iBAAb,EAAgC,6CAAhC,CAAN;EACD;;EACDC,GAAG,CAACU,OAAJ,GAAc,MAAMC,yBAAA,CAAcC,uBAAd,CAAsChB,WAAtC,EAAmDI,GAAnD,CAApB;EACA,OAAO;IACLA,GAAG,EAAE,EACH,GAAGA,GADA;MAEHO,UAAU,EAAEA;IAFT,CADA;IAKLF,GALK;IAMLJ;EANK,CAAP;AAQD"}