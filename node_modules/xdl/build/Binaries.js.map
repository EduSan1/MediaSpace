{"version":3,"file":"Binaries.js","names":["OSX_SOURCE_PATH","path","join","__dirname","_hasbinAsync","name","Promise","resolve","reject","hasbin","result","getBinariesPath","process","platform","XDLError","addToPathAsync","ignoreBundledBinaries","UserSettings","getAsync","includes","binariesPath","_prependToPath","newPath","currentPath","env","PATH","length","delimiter","writePathToUserSettingsAsync","setAsync","pathFile","dotExpoHomeDirectory","fs","writeFile","_isDirectory","dir","statSync","isDirectory","isXcodeInstalled"],"sources":["../src/Binaries.ts"],"sourcesContent":["import fs from 'fs-extra';\nimport hasbin from 'hasbin';\nimport path from 'path';\n\nimport { UserSettings, XDLError } from './internal';\n\nexport const OSX_SOURCE_PATH = path.join(__dirname, '..', 'binaries', 'osx');\n\nfunction _hasbinAsync(name: string) {\n  return new Promise((resolve, reject) => {\n    hasbin(name, result => {\n      resolve(result);\n    });\n  });\n}\n\nexport function getBinariesPath(): string {\n  if (process.platform === 'darwin') {\n    return path.join(__dirname, '..', 'binaries', 'osx');\n  } else if (process.platform === 'win32') {\n    return path.join(__dirname, '..', 'binaries', 'windows');\n  } else if (process.platform === 'linux') {\n    return path.join(__dirname, '..', 'binaries', 'linux');\n  } else {\n    throw new XDLError('PLATFORM_NOT_SUPPORTED', 'Platform not supported.');\n  }\n}\n\nexport async function addToPathAsync(name: string): Promise<void> {\n  if (await _hasbinAsync(name)) {\n    return;\n  }\n\n  // Users can set {ignoreBundledBinaries: [\"watchman\"]} to tell us to never use our version\n  const ignoreBundledBinaries = await UserSettings.getAsync(\n    'ignoreBundledBinaries',\n    [] as string[]\n  );\n  if (ignoreBundledBinaries.includes(name)) {\n    return;\n  }\n\n  const binariesPath = path.join(getBinariesPath(), name);\n  _prependToPath(binariesPath);\n}\n\nfunction _prependToPath(newPath: string) {\n  let currentPath = process.env.PATH ? process.env.PATH : '';\n  if (currentPath.length > 0) {\n    const delimiter = process.platform === 'win32' ? ';' : ':';\n    currentPath = `${delimiter}${currentPath}`;\n  }\n\n  process.env.PATH = `${newPath}${currentPath}`;\n}\n\nexport async function writePathToUserSettingsAsync(): Promise<void> {\n  await UserSettings.setAsync('PATH', process.env.PATH);\n\n  // Used in detach app\n  const pathFile = path.join(UserSettings.dotExpoHomeDirectory(), 'PATH');\n  await fs.writeFile(pathFile, process.env.PATH);\n}\n\nfunction _isDirectory(dir: string) {\n  try {\n    if (fs.statSync(dir).isDirectory()) {\n      return true;\n    }\n\n    return false;\n  } catch {\n    return false;\n  }\n}\n\nexport function isXcodeInstalled(): boolean {\n  return _isDirectory('/Applications/Xcode.app/');\n}\n"],"mappings":"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"}