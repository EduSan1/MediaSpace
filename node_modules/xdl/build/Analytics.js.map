{"version":3,"file":"Analytics.js","names":["PLATFORM_TO_ANALYTICS_PLATFORM","darwin","win32","linux","AnalyticsClient","userId","_userId","version","_version","flush","rudderstackClient","initializeClient","rudderstackWriteKey","rudderstackDataPlaneURL","packageVersion","RudderAnalytics","URL","toString","flushInterval","identifyUser","traits","userTraits","identify","context","getContext","logEvent","name","properties","track","event","platform","os","device","model","brand","release","app","defaultClient"],"sources":["../src/Analytics.ts"],"sourcesContent":["import RudderAnalytics from '@expo/rudder-sdk-node';\nimport os from 'os';\nimport { URL } from 'url';\n\nconst PLATFORM_TO_ANALYTICS_PLATFORM: { [platform: string]: string } = {\n  darwin: 'Mac',\n  win32: 'Windows',\n  linux: 'Linux',\n};\n\nexport class AnalyticsClient {\n  private userTraits?: { [key: string]: any };\n  private rudderstackClient?: RudderAnalytics;\n  private _userId?: string;\n  private _version?: string;\n\n  public get userId() {\n    return this._userId;\n  }\n\n  public get version() {\n    return this._version;\n  }\n\n  public async flush() {\n    if (this.rudderstackClient) {\n      await this.rudderstackClient.flush();\n    }\n  }\n\n  public initializeClient(\n    rudderstackWriteKey: string,\n    rudderstackDataPlaneURL: string,\n    packageVersion: string\n  ) {\n    // Do not wait before flushing, we want node to close immediately if the programs ends\n    this.rudderstackClient = new RudderAnalytics(\n      rudderstackWriteKey,\n      new URL('/v1/batch', rudderstackDataPlaneURL).toString(),\n      {\n        flushInterval: 300,\n      }\n    );\n    this._version = packageVersion;\n  }\n\n  public identifyUser(userId: string, traits: { [key: string]: any }) {\n    this._userId = userId;\n    this.userTraits = traits;\n\n    if (this.rudderstackClient) {\n      this.rudderstackClient.identify({\n        userId: this._userId,\n        traits: this.userTraits,\n        context: this.getContext(),\n      });\n    }\n  }\n\n  public logEvent(name: string, properties: any = {}) {\n    if (this.rudderstackClient && this._userId) {\n      this.rudderstackClient.track({\n        userId: this._userId,\n        event: name,\n        properties,\n        context: this.getContext(),\n      });\n    }\n  }\n\n  private getContext(): any {\n    const platform = PLATFORM_TO_ANALYTICS_PLATFORM[os.platform()] || os.platform();\n    const context = {\n      device: {\n        model: platform,\n        brand: platform,\n      },\n      os: {\n        name: platform,\n        version: os.release(),\n      },\n      app: {},\n    };\n\n    if (this._version) {\n      context.app = {\n        version: this._version,\n      };\n    }\n\n    return context;\n  }\n}\n\nconst defaultClient = new AnalyticsClient();\n\nexport default defaultClient;\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;;;AAEA,MAAMA,8BAA8D,GAAG;EACrEC,MAAM,EAAE,KAD6D;EAErEC,KAAK,EAAE,SAF8D;EAGrEC,KAAK,EAAE;AAH8D,CAAvE;;AAMO,MAAMC,eAAN,CAAsB;EAAA;IAAA;;IAAA;;IAAA;;IAAA;EAAA;;EAMV,IAANC,MAAM,GAAG;IAClB,OAAO,KAAKC,OAAZ;EACD;;EAEiB,IAAPC,OAAO,GAAG;IACnB,OAAO,KAAKC,QAAZ;EACD;;EAEiB,MAALC,KAAK,GAAG;IACnB,IAAI,KAAKC,iBAAT,EAA4B;MAC1B,MAAM,KAAKA,iBAAL,CAAuBD,KAAvB,EAAN;IACD;EACF;;EAEME,gBAAgB,CACrBC,mBADqB,EAErBC,uBAFqB,EAGrBC,cAHqB,EAIrB;IACA;IACA,KAAKJ,iBAAL,GAAyB,KAAIK,wBAAJ,EACvBH,mBADuB,EAEvB,KAAII,UAAJ,EAAQ,WAAR,EAAqBH,uBAArB,EAA8CI,QAA9C,EAFuB,EAGvB;MACEC,aAAa,EAAE;IADjB,CAHuB,CAAzB;IAOA,KAAKV,QAAL,GAAgBM,cAAhB;EACD;;EAEMK,YAAY,CAACd,MAAD,EAAiBe,MAAjB,EAAiD;IAClE,KAAKd,OAAL,GAAeD,MAAf;IACA,KAAKgB,UAAL,GAAkBD,MAAlB;;IAEA,IAAI,KAAKV,iBAAT,EAA4B;MAC1B,KAAKA,iBAAL,CAAuBY,QAAvB,CAAgC;QAC9BjB,MAAM,EAAE,KAAKC,OADiB;QAE9Bc,MAAM,EAAE,KAAKC,UAFiB;QAG9BE,OAAO,EAAE,KAAKC,UAAL;MAHqB,CAAhC;IAKD;EACF;;EAEMC,QAAQ,CAACC,IAAD,EAAeC,UAAe,GAAG,EAAjC,EAAqC;IAClD,IAAI,KAAKjB,iBAAL,IAA0B,KAAKJ,OAAnC,EAA4C;MAC1C,KAAKI,iBAAL,CAAuBkB,KAAvB,CAA6B;QAC3BvB,MAAM,EAAE,KAAKC,OADc;QAE3BuB,KAAK,EAAEH,IAFoB;QAG3BC,UAH2B;QAI3BJ,OAAO,EAAE,KAAKC,UAAL;MAJkB,CAA7B;IAMD;EACF;;EAEOA,UAAU,GAAQ;IACxB,MAAMM,QAAQ,GAAG9B,8BAA8B,CAAC+B,aAAA,CAAGD,QAAH,EAAD,CAA9B,IAAiDC,aAAA,CAAGD,QAAH,EAAlE;;IACA,MAAMP,OAAO,GAAG;MACdS,MAAM,EAAE;QACNC,KAAK,EAAEH,QADD;QAENI,KAAK,EAAEJ;MAFD,CADM;MAKdC,EAAE,EAAE;QACFL,IAAI,EAAEI,QADJ;QAEFvB,OAAO,EAAEwB,aAAA,CAAGI,OAAH;MAFP,CALU;MASdC,GAAG,EAAE;IATS,CAAhB;;IAYA,IAAI,KAAK5B,QAAT,EAAmB;MACjBe,OAAO,CAACa,GAAR,GAAc;QACZ7B,OAAO,EAAE,KAAKC;MADF,CAAd;IAGD;;IAED,OAAOe,OAAP;EACD;;AAjF0B;;;AAoF7B,MAAMc,aAAa,GAAG,IAAIjC,eAAJ,EAAtB;eAEeiC,a"}