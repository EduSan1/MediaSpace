{"version":3,"file":"getRunningProcess.js","names":["defaultOptions","encoding","stdio","getPID","port","execFileSync","split","trim","getPackageName","packageRoot","packageJson","path","join","require","name","getProcessCommand","pid","procDirectory","results","execSync","replace","getDirectoryOfProcessById","processId","getRunningProcess","directory","command"],"sources":["../../src/utils/getRunningProcess.ts"],"sourcesContent":["import { execFileSync, execSync, ExecSyncOptionsWithStringEncoding } from 'child_process';\nimport * as path from 'path';\n\nconst defaultOptions: ExecSyncOptionsWithStringEncoding = {\n  encoding: 'utf8',\n  stdio: ['pipe', 'pipe', 'ignore'],\n};\n\nfunction getPID(port: number) {\n  return execFileSync('lsof', [`-i:${port}`, '-P', '-t', '-sTCP:LISTEN'], defaultOptions)\n    .split('\\n')[0]\n    .trim();\n}\n\nfunction getPackageName(packageRoot: string): string | null {\n  const packageJson = path.join(packageRoot.trim(), 'package.json');\n  try {\n    return require(packageJson).name || null;\n  } catch {\n    return null;\n  }\n}\n\nfunction getProcessCommand(pid: string, procDirectory: string): string {\n  const results = execSync(`ps -o command -p ${pid} | sed -n 2p`, defaultOptions)\n    .replace(/\\n$/, '')\n    .trim();\n\n  const name = getPackageName(procDirectory);\n  return name ? name : results;\n}\n\nfunction getDirectoryOfProcessById(processId: string): string {\n  return execSync(\n    'lsof -p ' + processId + ' | awk \\'$4==\"cwd\" {for (i=9; i<=NF; i++) printf \"%s \", $i}\\'',\n    defaultOptions\n  ).trim();\n}\n\nexport function getRunningProcess(\n  port: number\n): { pid: string; directory: string; command: string } | null {\n  try {\n    // 63828\n    const pid = getPID(port);\n    // /Users/evanbacon/Documents/GitHub/lab/myapp\n    const directory = getDirectoryOfProcessById(pid);\n    // /Users/evanbacon/Documents/GitHub/lab/myapp/package.json\n    const command = getProcessCommand(pid, directory);\n    // TODO: Have a better message for reusing another process.\n    return { pid, directory, command };\n  } catch {\n    return null;\n  }\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;;;AAEA,MAAMA,cAAiD,GAAG;EACxDC,QAAQ,EAAE,MAD8C;EAExDC,KAAK,EAAE,CAAC,MAAD,EAAS,MAAT,EAAiB,QAAjB;AAFiD,CAA1D;;AAKA,SAASC,MAAT,CAAgBC,IAAhB,EAA8B;EAC5B,OAAO,IAAAC,6BAAA,EAAa,MAAb,EAAqB,CAAE,MAAKD,IAAK,EAAZ,EAAe,IAAf,EAAqB,IAArB,EAA2B,cAA3B,CAArB,EAAiEJ,cAAjE,EACJM,KADI,CACE,IADF,EACQ,CADR,EAEJC,IAFI,EAAP;AAGD;;AAED,SAASC,cAAT,CAAwBC,WAAxB,EAA4D;EAC1D,MAAMC,WAAW,GAAGC,IAAI,GAACC,IAAL,CAAUH,WAAW,CAACF,IAAZ,EAAV,EAA8B,cAA9B,CAApB;;EACA,IAAI;IACF,OAAOM,OAAO,CAACH,WAAD,CAAP,CAAqBI,IAArB,IAA6B,IAApC;EACD,CAFD,CAEE,MAAM;IACN,OAAO,IAAP;EACD;AACF;;AAED,SAASC,iBAAT,CAA2BC,GAA3B,EAAwCC,aAAxC,EAAuE;EACrE,MAAMC,OAAO,GAAG,IAAAC,yBAAA,EAAU,oBAAmBH,GAAI,cAAjC,EAAgDhB,cAAhD,EACboB,OADa,CACL,KADK,EACE,EADF,EAEbb,IAFa,EAAhB;EAIA,MAAMO,IAAI,GAAGN,cAAc,CAACS,aAAD,CAA3B;EACA,OAAOH,IAAI,GAAGA,IAAH,GAAUI,OAArB;AACD;;AAED,SAASG,yBAAT,CAAmCC,SAAnC,EAA8D;EAC5D,OAAO,IAAAH,yBAAA,EACL,aAAaG,SAAb,GAAyB,+DADpB,EAELtB,cAFK,EAGLO,IAHK,EAAP;AAID;;AAEM,SAASgB,iBAAT,CACLnB,IADK,EAEuD;EAC5D,IAAI;IACF;IACA,MAAMY,GAAG,GAAGb,MAAM,CAACC,IAAD,CAAlB,CAFE,CAGF;;IACA,MAAMoB,SAAS,GAAGH,yBAAyB,CAACL,GAAD,CAA3C,CAJE,CAKF;;IACA,MAAMS,OAAO,GAAGV,iBAAiB,CAACC,GAAD,EAAMQ,SAAN,CAAjC,CANE,CAOF;;IACA,OAAO;MAAER,GAAF;MAAOQ,SAAP;MAAkBC;IAAlB,CAAP;EACD,CATD,CASE,MAAM;IACN,OAAO,IAAP;EACD;AACF"}