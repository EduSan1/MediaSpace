{"version":3,"file":"ModuleVersion.js","names":["createModuleVersionChecker","name","currentVersion","UpdateCacher","FsCache","Cacher","pkgJson","pTimeout","npmPackageJson","version","latestVersion","latestVersionAsync","deprecated","checkAsync","getAsync","updateIsAvailable","semver","gt","latest","current"],"sources":["../../src/tools/ModuleVersion.ts"],"sourcesContent":["import latestVersionAsync from 'latest-version';\nimport pTimeout from 'p-timeout';\nimport npmPackageJson from 'package-json';\nimport semver from 'semver';\n\nimport { FsCache } from '../internal';\n\n/** @deprecated just use the update-check npm package */\nfunction createModuleVersionChecker(name: string, currentVersion: string) {\n  const UpdateCacher = new FsCache.Cacher(\n    async () => {\n      const pkgJson = await pTimeout(npmPackageJson(name, { version: currentVersion }), 2000);\n      return {\n        latestVersion: await pTimeout(latestVersionAsync(name), 2000),\n        deprecated: pkgJson.deprecated,\n      };\n    },\n    `${name}-${currentVersion}-updates.json`,\n    24 * 60 * 60 * 1000 // one day\n  );\n\n  async function checkAsync() {\n    const { latestVersion, deprecated } = await UpdateCacher.getAsync();\n    return {\n      updateIsAvailable: semver.gt(latestVersion, currentVersion),\n      latest: latestVersion,\n      current: currentVersion,\n      deprecated,\n    };\n  }\n\n  return { checkAsync };\n}\n\nexport { createModuleVersionChecker };\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAEA;AACA,SAASA,0BAAT,CAAoCC,IAApC,EAAkDC,cAAlD,EAA0E;EACxE,MAAMC,YAAY,GAAG,KAAIC,mBAAA,CAAQC,MAAZ,EACnB,YAAY;IACV,MAAMC,OAAO,GAAG,MAAM,IAAAC,mBAAA,EAAS,IAAAC,sBAAA,EAAeP,IAAf,EAAqB;MAAEQ,OAAO,EAAEP;IAAX,CAArB,CAAT,EAA4D,IAA5D,CAAtB;IACA,OAAO;MACLQ,aAAa,EAAE,MAAM,IAAAH,mBAAA,EAAS,IAAAI,wBAAA,EAAmBV,IAAnB,CAAT,EAAmC,IAAnC,CADhB;MAELW,UAAU,EAAEN,OAAO,CAACM;IAFf,CAAP;EAID,CAPkB,EAQlB,GAAEX,IAAK,IAAGC,cAAe,eARP,EASnB,KAAK,EAAL,GAAU,EAAV,GAAe,IATI,CASC;EATD,CAArB;;EAYA,eAAeW,UAAf,GAA4B;IAC1B,MAAM;MAAEH,aAAF;MAAiBE;IAAjB,IAAgC,MAAMT,YAAY,CAACW,QAAb,EAA5C;IACA,OAAO;MACLC,iBAAiB,EAAEC,iBAAA,CAAOC,EAAP,CAAUP,aAAV,EAAyBR,cAAzB,CADd;MAELgB,MAAM,EAAER,aAFH;MAGLS,OAAO,EAAEjB,cAHJ;MAILU;IAJK,CAAP;EAMD;;EAED,OAAO;IAAEC;EAAF,CAAP;AACD"}