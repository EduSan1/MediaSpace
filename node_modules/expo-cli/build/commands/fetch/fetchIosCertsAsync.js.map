{"version":3,"file":"fetchIosCertsAsync.js","names":["actionAsync","projectRoot","inProjectDir","filename","path","resolve","bundleIdentifier","getOrPromptForBundleIdentifier","ctx","Context","init","app","accountName","projectOwner","projectName","manifest","slug","Log","log","appCredentials","ios","getAppCredentials","pushCredentials","getPushKey","distCredentials","getDistCert","certP12","certPassword","certPrivateSigningKey","apnsKeyId","apnsKeyP8","pushP12","pushPassword","provisioningProfile","teamId","credentials","undefined","distPath","fs","writeFile","Buffer","from","distPrivateKeyPath","apnsKeyP8Path","pushPath","provisioningProfilePath","chalk","bold","yellow","CommandError"],"sources":["../../../src/commands/fetch/fetchIosCertsAsync.ts"],"sourcesContent":["import chalk from 'chalk';\nimport * as fs from 'fs-extra';\nimport * as path from 'path';\n\nimport CommandError from '../../CommandError';\nimport { Context } from '../../credentials/context';\nimport Log from '../../log';\nimport { getOrPromptForBundleIdentifier } from '../utils/getOrPromptApplicationId';\n\nexport async function actionAsync(projectRoot: string): Promise<void> {\n  const inProjectDir = (filename: string): string => path.resolve(projectRoot, filename);\n\n  const bundleIdentifier = await getOrPromptForBundleIdentifier(projectRoot);\n\n  try {\n    const ctx = new Context();\n    await ctx.init(projectRoot);\n\n    const app = {\n      accountName: ctx.projectOwner,\n      projectName: ctx.manifest.slug,\n      bundleIdentifier,\n    };\n    Log.log(\n      `Retrieving iOS credentials for @${app.accountName}/${app.projectName} (${bundleIdentifier})`\n    );\n    const appCredentials = await ctx.ios.getAppCredentials(app);\n    const pushCredentials = await ctx.ios.getPushKey(app);\n    const distCredentials = await ctx.ios.getDistCert(app);\n\n    const { certP12, certPassword, certPrivateSigningKey } = distCredentials ?? {};\n    const { apnsKeyId, apnsKeyP8 } = pushCredentials ?? {};\n    const { pushP12, pushPassword, provisioningProfile, teamId } =\n      appCredentials?.credentials ?? {};\n\n    if (teamId !== undefined) {\n      Log.log(`These credentials are associated with Apple Team ID: ${teamId}`);\n    }\n    if (certP12) {\n      const distPath = inProjectDir(`${app.projectName}_dist.p12`);\n      await fs.writeFile(distPath, Buffer.from(certP12, 'base64'));\n    }\n    if (certPrivateSigningKey) {\n      const distPrivateKeyPath = inProjectDir(`${app.projectName}_dist_cert_private.key`);\n      await fs.writeFile(distPrivateKeyPath, certPrivateSigningKey);\n    }\n    if (certP12 || certPrivateSigningKey) {\n      Log.log('Wrote distribution cert credentials to disk.');\n    }\n    if (apnsKeyP8) {\n      const apnsKeyP8Path = inProjectDir(`${app.projectName}_apns_key.p8`);\n      await fs.writeFile(apnsKeyP8Path, apnsKeyP8);\n      Log.log('Wrote push key credentials to disk.');\n    }\n    if (pushP12) {\n      const pushPath = inProjectDir(`${app.projectName}_push.p12`);\n      await fs.writeFile(pushPath, Buffer.from(pushP12, 'base64'));\n    }\n    if (pushP12) {\n      Log.log('Wrote push cert credentials to disk.');\n    }\n    if (provisioningProfile) {\n      const provisioningProfilePath = path.resolve(\n        projectRoot,\n        `${app.projectName}.mobileprovision`\n      );\n      await fs.writeFile(provisioningProfilePath, Buffer.from(provisioningProfile, 'base64'));\n      Log.log('Wrote provisioning profile to disk');\n    }\n    Log.log(`Save these important values as well:\n\nDistribution P12 password: ${\n      certPassword ? chalk.bold(certPassword) : chalk.yellow('(not available)')\n    }\nPush Key ID:               ${apnsKeyId ? chalk.bold(apnsKeyId) : chalk.yellow('(not available)')}\nPush P12 password:         ${\n      pushPassword ? chalk.bold(pushPassword) : chalk.yellow('(not available)')\n    }\n`);\n  } catch {\n    throw new CommandError(\n      'Unable to fetch credentials for this project. Are you sure they exist?'\n    );\n  }\n\n  Log.log('All done!');\n}\n"],"mappings":"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"}