{"version":3,"file":"createMetadataJson.js","names":["createMetadataJson","bundles","fileNames","fileMetadata","Object","keys","forEach","platform","filename","assert","bundle","path","join","assets","asset","fileHashes","map","hash","ext","type","metadata","version","bundler"],"sources":["../../../src/commands/export/createMetadataJson.ts"],"sourcesContent":["import type { BundleOutput } from '@expo/dev-server';\nimport assert from 'assert';\nimport path from 'path';\n\nexport type BundlePlatform = 'android' | 'ios';\n\ntype PlatformMetadata = { bundle: string; assets: { path: string; ext: string }[] };\n\ntype FileMetadata = {\n  [key in BundlePlatform]: PlatformMetadata;\n};\n\ntype Metadata = {\n  version: 0;\n  bundler: 'metro';\n  fileMetadata: FileMetadata;\n};\n\nexport function createMetadataJson({\n  bundles,\n  fileNames,\n}: {\n  bundles: Record<string, Pick<BundleOutput, 'assets'>>;\n  fileNames: Record<string, string>;\n}): Metadata {\n  // Build metadata.json\n  const fileMetadata: {\n    [platform: string]: Partial<PlatformMetadata>;\n  } = {};\n  Object.keys(bundles).forEach(platform => {\n    const filename = fileNames[platform];\n    assert(filename, `Expected filename for ${platform}`);\n\n    fileMetadata[platform] = {\n      bundle: path.join('bundles', filename),\n      assets: [],\n    };\n\n    bundles[platform].assets.forEach((asset: { type: string; fileHashes: string[] }) => {\n      fileMetadata[platform].assets = [\n        ...fileMetadata[platform].assets!,\n        ...asset.fileHashes.map(hash => {\n          return { path: path.join('assets', hash), ext: asset.type };\n        }),\n      ];\n    });\n  });\n  const metadata: Metadata = {\n    version: 0,\n    bundler: 'metro',\n    fileMetadata: fileMetadata as FileMetadata,\n  };\n\n  return metadata;\n}\n"],"mappings":";;;;;;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAgBO,SAASA,kBAAT,CAA4B;EACjCC,OADiC;EAEjCC;AAFiC,CAA5B,EAMM;EACX;EACA,MAAMC,YAEL,GAAG,EAFJ;EAGAC,MAAM,CAACC,IAAP,CAAYJ,OAAZ,EAAqBK,OAArB,CAA6BC,QAAQ,IAAI;IACvC,MAAMC,QAAQ,GAAGN,SAAS,CAACK,QAAD,CAA1B;IACA,IAAAE,iBAAA,EAAOD,QAAP,EAAkB,yBAAwBD,QAAS,EAAnD;IAEAJ,YAAY,CAACI,QAAD,CAAZ,GAAyB;MACvBG,MAAM,EAAEC,eAAA,CAAKC,IAAL,CAAU,SAAV,EAAqBJ,QAArB,CADe;MAEvBK,MAAM,EAAE;IAFe,CAAzB;IAKAZ,OAAO,CAACM,QAAD,CAAP,CAAkBM,MAAlB,CAAyBP,OAAzB,CAAkCQ,KAAD,IAAmD;MAClFX,YAAY,CAACI,QAAD,CAAZ,CAAuBM,MAAvB,GAAgC,CAC9B,GAAGV,YAAY,CAACI,QAAD,CAAZ,CAAuBM,MADI,EAE9B,GAAGC,KAAK,CAACC,UAAN,CAAiBC,GAAjB,CAAqBC,IAAI,IAAI;QAC9B,OAAO;UAAEN,IAAI,EAAEA,eAAA,CAAKC,IAAL,CAAU,QAAV,EAAoBK,IAApB,CAAR;UAAmCC,GAAG,EAAEJ,KAAK,CAACK;QAA9C,CAAP;MACD,CAFE,CAF2B,CAAhC;IAMD,CAPD;EAQD,CAjBD;EAkBA,MAAMC,QAAkB,GAAG;IACzBC,OAAO,EAAE,CADgB;IAEzBC,OAAO,EAAE,OAFgB;IAGzBnB,YAAY,EAAEA;EAHW,CAA3B;EAMA,OAAOiB,QAAP;AACD"}