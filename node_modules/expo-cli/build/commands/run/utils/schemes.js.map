{"version":3,"file":"schemes.js","names":["getSchemesForIosAsync","projectRoot","configPath","IOSConfig","Paths","getInfoPlistPath","rawPlist","fs","readFileSync","plistObject","plist","parse","sortLongest","Scheme","getSchemesFromPlist","getSchemesForAndroidAsync","AndroidConfig","getAndroidManifestAsync","manifest","Manifest","readAndroidManifestAsync","getSchemesFromManifest","intersecting","a","b","c","d","length","filter","value","includes","getOptionalDevClientSchemeAsync","hasIos","hasAndroid","Promise","all","hasRequiredIOSFilesAsync","hasRequiredAndroidFilesAsync","ios","android","getManagedDevClientSchemeAsync","matching","exp","getConfig","skipSDKVersionRequirement","getDefaultScheme","require","resolveFrom","scheme","Log","warn","obj","sort"],"sources":["../../../../src/commands/run/utils/schemes.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport { AndroidConfig, IOSConfig } from '@expo/config-plugins';\nimport plist from '@expo/plist';\nimport fs from 'fs';\nimport resolveFrom from 'resolve-from';\n\nimport Log from '../../../log';\nimport {\n  hasRequiredAndroidFilesAsync,\n  hasRequiredIOSFilesAsync,\n} from '../../eject/clearNativeFolder';\n\nexport async function getSchemesForIosAsync(projectRoot: string) {\n  try {\n    const configPath = IOSConfig.Paths.getInfoPlistPath(projectRoot);\n    const rawPlist = fs.readFileSync(configPath, 'utf8');\n    const plistObject = plist.parse(rawPlist);\n    return sortLongest(IOSConfig.Scheme.getSchemesFromPlist(plistObject));\n  } catch {\n    // No ios folder or some other error\n    return [];\n  }\n}\n\nexport async function getSchemesForAndroidAsync(projectRoot: string) {\n  try {\n    const configPath = await AndroidConfig.Paths.getAndroidManifestAsync(projectRoot);\n    const manifest = await AndroidConfig.Manifest.readAndroidManifestAsync(configPath);\n    return sortLongest(\n      await AndroidConfig.Scheme.getSchemesFromManifest(manifest, 'expo-development-client')\n    );\n  } catch {\n    // No android folder or some other error\n    return [];\n  }\n}\n\nfunction intersecting<T>(a: T[], b: T[]): T[] {\n  const [c, d] = a.length > b.length ? [a, b] : [b, a];\n  return c.filter(value => d.includes(value));\n}\n\nexport async function getOptionalDevClientSchemeAsync(projectRoot: string): Promise<string | null> {\n  const [hasIos, hasAndroid] = await Promise.all([\n    hasRequiredIOSFilesAsync(projectRoot),\n    hasRequiredAndroidFilesAsync(projectRoot),\n  ]);\n\n  const [ios, android] = await Promise.all([\n    getSchemesForIosAsync(projectRoot),\n    getSchemesForAndroidAsync(projectRoot),\n  ]);\n\n  // Allow managed projects\n  if (!hasIos && !hasAndroid) {\n    return getManagedDevClientSchemeAsync(projectRoot);\n  }\n\n  let matching: string;\n  // Allow for only one native project to exist.\n  if (!hasIos) {\n    matching = android[0];\n  } else if (!hasAndroid) {\n    matching = ios[0];\n  } else {\n    [matching] = intersecting(ios, android);\n  }\n  return matching ?? null;\n}\n\nasync function getManagedDevClientSchemeAsync(projectRoot: string): Promise<string | null> {\n  const { exp } = getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n  });\n  try {\n    const getDefaultScheme = require(resolveFrom(projectRoot, 'expo-dev-client/getDefaultScheme'));\n    const scheme = getDefaultScheme(exp);\n    return scheme;\n  } catch {\n    Log.warn(\n      '\\nDevelopment build: Unable to get the default URI scheme for the project. Please make sure the expo-dev-client package is installed.'\n    );\n    // throw new CommandError(error);\n    return null;\n  }\n}\n\n// sort longest to ensure uniqueness.\n// this might be undesirable as it causes the QR code to be longer.\nfunction sortLongest(obj: string[]): string[] {\n  return obj.sort((a, b) => b.length - a.length);\n}\n"],"mappings":"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"}