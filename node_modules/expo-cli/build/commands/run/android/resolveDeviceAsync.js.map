{"version":3,"file":"resolveDeviceAsync.js","names":["ensureEmulatorOpenAsync","device","devices","Android","getAllAvailableDevicesAsync","bootedDevice","attemptToStartEmulatorOrAssertAsync","CommandError","resolveDeviceAsync","catch","promptForDeviceAsync","Log","log","chalk","dim","name","searchValue","toLowerCase","resolved","find"],"sources":["../../../../src/commands/run/android/resolveDeviceAsync.ts"],"sourcesContent":["import chalk from 'chalk';\nimport { Android } from 'xdl';\n\nimport CommandError from '../../../CommandError';\nimport Log from '../../../log';\n\nasync function ensureEmulatorOpenAsync(device?: Android.Device): Promise<Android.Device> {\n  if (!device) {\n    const devices = await Android.getAllAvailableDevicesAsync();\n    device = devices[0];\n  }\n\n  const bootedDevice = await Android.attemptToStartEmulatorOrAssertAsync(device);\n  if (!bootedDevice) {\n    // TODO: Improve\n    throw new CommandError('Unauthorized');\n  }\n  return bootedDevice;\n}\n\nexport async function resolveDeviceAsync(device?: string | boolean): Promise<Android.Device> {\n  if (!device) {\n    return await ensureEmulatorOpenAsync();\n  }\n\n  const devices: Android.Device[] = await Android.getAllAvailableDevicesAsync().catch(() => []);\n\n  if (device === true) {\n    // --device with no props after\n    const device = await Android.promptForDeviceAsync(devices);\n    if (!device) {\n      throw new CommandError('Select a device to use');\n    }\n    Log.log(chalk.dim`\\u203A Using --device ${device.name}`);\n    return device;\n  }\n  const searchValue = device.toLowerCase();\n  const resolved = devices.find(device => {\n    return device.name.toLowerCase() === searchValue;\n  });\n\n  if (!resolved) {\n    throw new CommandError(`No device name matching \"${device}\"`);\n  }\n\n  return await ensureEmulatorOpenAsync(resolved);\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAEA,eAAeA,uBAAf,CAAuCC,MAAvC,EAAyF;EACvF,IAAI,CAACA,MAAL,EAAa;IACX,MAAMC,OAAO,GAAG,MAAMC,cAAA,CAAQC,2BAAR,EAAtB;IACAH,MAAM,GAAGC,OAAO,CAAC,CAAD,CAAhB;EACD;;EAED,MAAMG,YAAY,GAAG,MAAMF,cAAA,CAAQG,mCAAR,CAA4CL,MAA5C,CAA3B;;EACA,IAAI,CAACI,YAAL,EAAmB;IACjB;IACA,MAAM,KAAIE,uBAAJ,EAAiB,cAAjB,CAAN;EACD;;EACD,OAAOF,YAAP;AACD;;AAEM,eAAeG,kBAAf,CAAkCP,MAAlC,EAAsF;EAC3F,IAAI,CAACA,MAAL,EAAa;IACX,OAAO,MAAMD,uBAAuB,EAApC;EACD;;EAED,MAAME,OAAyB,GAAG,MAAMC,cAAA,CAAQC,2BAAR,GAAsCK,KAAtC,CAA4C,MAAM,EAAlD,CAAxC;;EAEA,IAAIR,MAAM,KAAK,IAAf,EAAqB;IACnB;IACA,MAAMA,MAAM,GAAG,MAAME,cAAA,CAAQO,oBAAR,CAA6BR,OAA7B,CAArB;;IACA,IAAI,CAACD,MAAL,EAAa;MACX,MAAM,KAAIM,uBAAJ,EAAiB,wBAAjB,CAAN;IACD;;IACDI,cAAA,CAAIC,GAAJ,CAAQC,gBAAA,CAAMC,GAAI,yBAAwBb,MAAM,CAACc,IAAK,EAAtD;;IACA,OAAOd,MAAP;EACD;;EACD,MAAMe,WAAW,GAAGf,MAAM,CAACgB,WAAP,EAApB;EACA,MAAMC,QAAQ,GAAGhB,OAAO,CAACiB,IAAR,CAAalB,MAAM,IAAI;IACtC,OAAOA,MAAM,CAACc,IAAP,CAAYE,WAAZ,OAA8BD,WAArC;EACD,CAFgB,CAAjB;;EAIA,IAAI,CAACE,QAAL,EAAe;IACb,MAAM,KAAIX,uBAAJ,EAAkB,4BAA2BN,MAAO,GAApD,CAAN;EACD;;EAED,OAAO,MAAMD,uBAAuB,CAACkB,QAAD,CAApC;AACD"}