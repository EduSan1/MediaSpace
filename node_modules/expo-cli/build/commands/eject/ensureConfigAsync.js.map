{"version":3,"file":"ensureConfigAsync.js","names":["ensureConfigExistsAsync","projectRoot","config","getConfig","skipSDKVersionRequirement","dynamicConfigPath","staticConfigPath","exp","_internal","JsonFile","writeAsync","path","join","expo","json5","error","Log","addNewLineIfNone","CommandError","message","ensureConfigAsync","platforms","includes","getOrPromptForPackage","getOrPromptForBundleIdentifier","pkg","entryPoint","log"],"sources":["../../../src/commands/eject/ensureConfigAsync.ts"],"sourcesContent":["import { ExpoConfig, getConfig, PackageJSONConfig } from '@expo/config';\nimport { ModPlatform } from '@expo/config-plugins';\nimport JsonFile, { JSONObject } from '@expo/json-file';\nimport path from 'path';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport {\n  getOrPromptForBundleIdentifier,\n  getOrPromptForPackage,\n} from '../utils/getOrPromptApplicationId';\n\n/**\n * If an Expo config file does not exist, write a new one using the in-memory config.\n *\n * @param projectRoot\n */\nexport async function ensureConfigExistsAsync(projectRoot: string) {\n  try {\n    const config = getConfig(projectRoot, { skipSDKVersionRequirement: false });\n    // If no config exists in the file system then we should generate one so the process doesn't fail.\n    if (!config.dynamicConfigPath && !config.staticConfigPath) {\n      // Remove the internal object before writing.\n      delete config.exp._internal;\n\n      // Don't check for a custom config path because the process should fail if a custom file doesn't exist.\n      // Write the generated config.\n      // writeConfigJsonAsync(projectRoot, config.exp);\n      await JsonFile.writeAsync(\n        // TODO: Write to app.config.json because it's easier to convert to a js config file.\n        path.join(projectRoot, 'app.json'),\n        { expo: (config.exp as unknown) as JSONObject },\n        { json5: false }\n      );\n    }\n  } catch (error: any) {\n    // TODO(Bacon): Currently this is already handled in the command\n    Log.addNewLineIfNone();\n    throw new CommandError(`${error.message}\\n`);\n  }\n}\n\nexport async function ensureConfigAsync({\n  projectRoot,\n  platforms,\n}: {\n  projectRoot: string;\n  platforms: ModPlatform[];\n}): Promise<{ exp: ExpoConfig; pkg: PackageJSONConfig }> {\n  await ensureConfigExistsAsync(projectRoot);\n\n  // Prompt for the Android package first because it's more strict than the bundle identifier\n  // this means you'll have a better chance at matching the bundle identifier with the package name.\n  if (platforms.includes('android')) {\n    await getOrPromptForPackage(projectRoot);\n  }\n\n  if (platforms.includes('ios')) {\n    await getOrPromptForBundleIdentifier(projectRoot);\n  }\n\n  // We need the SDK version to proceed\n  const { exp, pkg } = getConfig(projectRoot);\n\n  // TODO: Should we attempt to persist this change?\n  if (exp.entryPoint) {\n    delete exp.entryPoint;\n    Log.log(`\\u203A expo.entryPoint is not needed and has been removed.`);\n  }\n\n  // Read config again because prompting for bundle id or package name may have mutated the results.\n  return { exp, pkg };\n}\n"],"mappings":";;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAKA;AACA;AACA;AACA;AACA;AACO,eAAeA,uBAAf,CAAuCC,WAAvC,EAA4D;EACjE,IAAI;IACF,MAAMC,MAAM,GAAG,IAAAC,mBAAA,EAAUF,WAAV,EAAuB;MAAEG,yBAAyB,EAAE;IAA7B,CAAvB,CAAf,CADE,CAEF;;IACA,IAAI,CAACF,MAAM,CAACG,iBAAR,IAA6B,CAACH,MAAM,CAACI,gBAAzC,EAA2D;MACzD;MACA,OAAOJ,MAAM,CAACK,GAAP,CAAWC,SAAlB,CAFyD,CAIzD;MACA;MACA;;MACA,MAAMC,mBAAA,CAASC,UAAT,EACJ;MACAC,eAAA,CAAKC,IAAL,CAAUX,WAAV,EAAuB,UAAvB,CAFI,EAGJ;QAAEY,IAAI,EAAGX,MAAM,CAACK;MAAhB,CAHI,EAIJ;QAAEO,KAAK,EAAE;MAAT,CAJI,CAAN;IAMD;EACF,CAjBD,CAiBE,OAAOC,KAAP,EAAmB;IACnB;IACAC,cAAA,CAAIC,gBAAJ;;IACA,MAAM,KAAIC,uBAAJ,EAAkB,GAAEH,KAAK,CAACI,OAAQ,IAAlC,CAAN;EACD;AACF;;AAEM,eAAeC,iBAAf,CAAiC;EACtCnB,WADsC;EAEtCoB;AAFsC,CAAjC,EAMkD;EACvD,MAAMrB,uBAAuB,CAACC,WAAD,CAA7B,CADuD,CAGvD;EACA;;EACA,IAAIoB,SAAS,CAACC,QAAV,CAAmB,SAAnB,CAAJ,EAAmC;IACjC,MAAM,IAAAC,iDAAA,EAAsBtB,WAAtB,CAAN;EACD;;EAED,IAAIoB,SAAS,CAACC,QAAV,CAAmB,KAAnB,CAAJ,EAA+B;IAC7B,MAAM,IAAAE,0DAAA,EAA+BvB,WAA/B,CAAN;EACD,CAXsD,CAavD;;;EACA,MAAM;IAAEM,GAAF;IAAOkB;EAAP,IAAe,IAAAtB,mBAAA,EAAUF,WAAV,CAArB,CAduD,CAgBvD;;EACA,IAAIM,GAAG,CAACmB,UAAR,EAAoB;IAClB,OAAOnB,GAAG,CAACmB,UAAX;;IACAV,cAAA,CAAIW,GAAJ,CAAS,4DAAT;EACD,CApBsD,CAsBvD;;;EACA,OAAO;IAAEpB,GAAF;IAAOkB;EAAP,CAAP;AACD"}