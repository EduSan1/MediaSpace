{"version":3,"file":"setupWarnings.js","names":["warnIfDependenciesRequireAdditionalSetup","pkg","sdkVersion","appliedPlugins","warnings","getSetupWarnings","autoPlugins","getLegacyExpoPlugins","logSetupWarnings","pkgsWithExtraSetup","filter","plugin","includes","reduce","prev","curr","semver","lte","chalk","bold","dim","learnMore","dependencies","key","warningLength","Object","keys","length","Log","newLine","warnAdditionalSetupStep","logNewSection","plural","stopAndPersist","symbol","text","yellow","pkgName","message","entries","nested"],"sources":["../../../src/commands/eject/setupWarnings.ts"],"sourcesContent":["import { PackageJSONConfig } from '@expo/config';\nimport { getLegacyExpoPlugins } from '@expo/prebuild-config';\nimport chalk from 'chalk';\nimport semver from 'semver';\n\nimport Log from '../../log';\nimport { logNewSection } from '../../utils/ora';\nimport { learnMore } from '../utils/TerminalLink';\n\n/**\n * Some packages are not configured automatically on eject and may require\n * users to add some code, eg: to their AppDelegate.\n */\nexport function warnIfDependenciesRequireAdditionalSetup(\n  pkg: PackageJSONConfig,\n  sdkVersion?: string,\n  appliedPlugins?: string[]\n): Record<string, string> {\n  const warnings = getSetupWarnings({\n    pkg,\n    sdkVersion,\n    appliedPlugins: appliedPlugins ?? [],\n    autoPlugins: getLegacyExpoPlugins(),\n  });\n\n  logSetupWarnings(warnings);\n\n  return warnings;\n}\n\n// Exposed for testing\nexport function getSetupWarnings({\n  pkg,\n  sdkVersion,\n  appliedPlugins,\n  autoPlugins,\n}: {\n  pkg: PackageJSONConfig;\n  sdkVersion?: string;\n  appliedPlugins: string[];\n  autoPlugins: string[];\n}): Record<string, string> {\n  const pkgsWithExtraSetup = autoPlugins\n    .filter(plugin => !appliedPlugins?.includes(plugin))\n    .reduce<Record<string, string>>(\n      (prev, curr) => ({\n        ...prev,\n        [curr]: `https://github.com/expo/expo/tree/master/packages/${curr}`,\n      }),\n      {}\n    );\n\n  // Starting with SDK 40 the manifest is embedded in ejected apps automatically\n  if (sdkVersion && semver.lte(sdkVersion, '39.0.0')) {\n    pkgsWithExtraSetup['expo-constants'] = `${chalk.bold(\n      'Constants.manifest'\n    )} is not available in the bare workflow. You should replace it with ${chalk.bold(\n      'Updates.manifest'\n    )}. ${chalk.dim(\n      learnMore('https://docs.expo.dev/versions/latest/sdk/updates/#updatesmanifest')\n    )}`;\n  }\n\n  const warnings: Record<string, string> = {};\n  if (pkg.dependencies) {\n    for (const key in pkg.dependencies) {\n      if (key in pkgsWithExtraSetup) {\n        warnings[key] = pkgsWithExtraSetup[key];\n      }\n    }\n  }\n  return warnings;\n}\n\nfunction logSetupWarnings(warnings: Record<string, string>) {\n  const warningLength = Object.keys(warnings).length;\n  if (!warningLength) {\n    return;\n  }\n\n  Log.newLine();\n  const warnAdditionalSetupStep = logNewSection(\n    'Checking if any additional setup steps are required for installed SDK packages.'\n  );\n\n  const plural = warningLength > 1;\n\n  warnAdditionalSetupStep.stopAndPersist({\n    symbol: '⚠️ ',\n    text: chalk.yellow.bold(\n      `The app has ${warningLength} package${plural ? 's' : ''} that require${\n        plural ? '' : 's'\n      } extra setup before building:`\n    ),\n  });\n\n  for (const [pkgName, message] of Object.entries(warnings)) {\n    Log.nested(`\\u203A ${chalk.bold(pkgName)}: ${message}`);\n  }\n}\n"],"mappings":"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"}