{"version":3,"file":"installNodeDependenciesAsync.js","names":["installNodeDependenciesAsync","projectRoot","packageManager","clean","cleanJsDepsStep","logNewSection","time","Date","now","fs","remove","succeed","chalk","gray","installJsDepsStep","CreateApp","message","bold","fail","red","SilentError"],"sources":["../../../src/commands/eject/installNodeDependenciesAsync.ts"],"sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs-extra';\n\nimport { SilentError } from '../../CommandError';\nimport { logNewSection } from '../../utils/ora';\nimport * as CreateApp from '../utils/CreateApp';\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nexport async function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean && packageManager !== 'yarn') {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = logNewSection('Cleaning JavaScript dependencies');\n    const time = Date.now();\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed(\n      `Cleaned JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  }\n\n  const installJsDepsStep = logNewSection('Installing JavaScript dependencies');\n  try {\n    const time = Date.now();\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed(\n      `Installed JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  } catch {\n    const message = `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n      `${packageManager} install`\n    )} again manually.`;\n    installJsDepsStep.fail(chalk.red(message));\n    // TODO: actually show the error message from the package manager! :O\n    throw new SilentError(message);\n  }\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACO,eAAeA,4BAAf,CACLC,WADK,EAELC,cAFK,EAGL;EAAEC,KAAK,GAAG;AAAV,CAHK,EAIL;EACA,IAAIA,KAAK,IAAID,cAAc,KAAK,MAAhC,EAAwC;IACtC;IACA;IACA,MAAME,eAAe,GAAG,IAAAC,oBAAA,EAAc,kCAAd,CAAxB;IACA,MAAMC,IAAI,GAAGC,IAAI,CAACC,GAAL,EAAb,CAJsC,CAKtC;IACA;;IACA,MAAMC,kBAAA,CAAGC,MAAH,CAAU,cAAV,CAAN;IACAN,eAAe,CAACO,OAAhB,CACG,mCAAkCC,gBAAA,CAAMC,IAAN,CAAWN,IAAI,CAACC,GAAL,KAAaF,IAAb,GAAoB,IAA/B,CAAqC,EAD1E;EAGD;;EAED,MAAMQ,iBAAiB,GAAG,IAAAT,oBAAA,EAAc,oCAAd,CAA1B;;EACA,IAAI;IACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,GAAL,EAAb;IACA,MAAMO,SAAS,GAACf,4BAAV,CAAuCC,WAAvC,EAAoDC,cAApD,CAAN;IACAY,iBAAiB,CAACH,OAAlB,CACG,qCAAoCC,gBAAA,CAAMC,IAAN,CAAWN,IAAI,CAACC,GAAL,KAAaF,IAAb,GAAoB,IAA/B,CAAqC,EAD5E;EAGD,CAND,CAME,MAAM;IACN,MAAMU,OAAO,GAAI,uEAAsEd,cAAe,mBAAkBU,gBAAA,CAAMK,IAAN,CACrH,GAAEf,cAAe,UADoG,CAEtH,kBAFF;IAGAY,iBAAiB,CAACI,IAAlB,CAAuBN,gBAAA,CAAMO,GAAN,CAAUH,OAAV,CAAvB,EAJM,CAKN;;IACA,MAAM,KAAII,2BAAJ,EAAgBJ,OAAhB,CAAN;EACD;AACF"}