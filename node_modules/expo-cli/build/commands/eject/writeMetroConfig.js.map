{"version":3,"file":"writeMetroConfig.js","names":["writeMetroConfig","projectRoot","pkg","tempDir","updatingMetroConfigStep","logNewSection","sourceConfigPath","path","join","targetConfigPath","targetConfigPathExists","fs","existsSync","contents","createFileHash","readFileSync","targetContents","CommandError","stop","clear","metro","copySync","succeed","e","stopAndPersist","symbol","text","chalk","yellow","Log","nested","message","bold","dim","learnMore","newLine"],"sources":["../../../src/commands/eject/writeMetroConfig.ts"],"sourcesContent":["import { PackageJSONConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport fs from 'fs-extra';\nimport path from 'path';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport { logNewSection } from '../../utils/ora';\nimport { learnMore } from '../utils/TerminalLink';\nimport { createFileHash } from './updatePackageJson';\n\nexport function writeMetroConfig({\n  projectRoot,\n  pkg,\n  tempDir,\n}: {\n  projectRoot: string;\n  pkg: PackageJSONConfig;\n  tempDir: string;\n}) {\n  /**\n   * Add metro config, or warn if metro config already exists. The developer will need to add the\n   * hashAssetFiles plugin manually.\n   */\n\n  const updatingMetroConfigStep = logNewSection('Adding Metro bundler config');\n\n  try {\n    const sourceConfigPath = path.join(tempDir, 'metro.config.js');\n    const targetConfigPath = path.join(projectRoot, 'metro.config.js');\n    const targetConfigPathExists = fs.existsSync(targetConfigPath);\n    if (targetConfigPathExists) {\n      // Prevent re-runs from throwing an error if the metro config hasn't been modified.\n      const contents = createFileHash(fs.readFileSync(targetConfigPath, 'utf8'));\n      const targetContents = createFileHash(fs.readFileSync(sourceConfigPath, 'utf8'));\n      if (contents !== targetContents) {\n        throw new CommandError('Existing Metro config found; not overwriting.');\n      } else {\n        // Nothing to change, hide the step and exit.\n        updatingMetroConfigStep.stop();\n        updatingMetroConfigStep.clear();\n        return;\n      }\n    } else if (\n      fs.existsSync(path.join(projectRoot, 'metro.config.json')) ||\n      pkg.metro ||\n      fs.existsSync(path.join(projectRoot, 'rn-cli.config.js'))\n    ) {\n      throw new CommandError('Existing Metro config found; not overwriting.');\n    }\n\n    fs.copySync(sourceConfigPath, targetConfigPath);\n    updatingMetroConfigStep.succeed('Added Metro config');\n  } catch (e: any) {\n    updatingMetroConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.yellow('Skipped Metro config updates:'),\n    });\n    Log.nested(`\\u203A ${e.message}`);\n    Log.nested(\n      `\\u203A You will need to extend the default ${chalk.bold(\n        '@expo/metro-config'\n      )} in your Metro config.\\n  ${chalk.dim(\n        learnMore('https://docs.expo.dev/guides/customizing-metro')\n      )}`\n    );\n    Log.newLine();\n  }\n}\n"],"mappings":";;;;;;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAEO,SAASA,gBAAT,CAA0B;EAC/BC,WAD+B;EAE/BC,GAF+B;EAG/BC;AAH+B,CAA1B,EAQJ;EACD;AACF;AACA;AACA;EAEE,MAAMC,uBAAuB,GAAG,IAAAC,oBAAA,EAAc,6BAAd,CAAhC;;EAEA,IAAI;IACF,MAAMC,gBAAgB,GAAGC,eAAA,CAAKC,IAAL,CAAUL,OAAV,EAAmB,iBAAnB,CAAzB;;IACA,MAAMM,gBAAgB,GAAGF,eAAA,CAAKC,IAAL,CAAUP,WAAV,EAAuB,iBAAvB,CAAzB;;IACA,MAAMS,sBAAsB,GAAGC,kBAAA,CAAGC,UAAH,CAAcH,gBAAd,CAA/B;;IACA,IAAIC,sBAAJ,EAA4B;MAC1B;MACA,MAAMG,QAAQ,GAAG,IAAAC,mCAAA,EAAeH,kBAAA,CAAGI,YAAH,CAAgBN,gBAAhB,EAAkC,MAAlC,CAAf,CAAjB;MACA,MAAMO,cAAc,GAAG,IAAAF,mCAAA,EAAeH,kBAAA,CAAGI,YAAH,CAAgBT,gBAAhB,EAAkC,MAAlC,CAAf,CAAvB;;MACA,IAAIO,QAAQ,KAAKG,cAAjB,EAAiC;QAC/B,MAAM,KAAIC,uBAAJ,EAAiB,+CAAjB,CAAN;MACD,CAFD,MAEO;QACL;QACAb,uBAAuB,CAACc,IAAxB;QACAd,uBAAuB,CAACe,KAAxB;QACA;MACD;IACF,CAZD,MAYO,IACLR,kBAAA,CAAGC,UAAH,CAAcL,eAAA,CAAKC,IAAL,CAAUP,WAAV,EAAuB,mBAAvB,CAAd,KACAC,GAAG,CAACkB,KADJ,IAEAT,kBAAA,CAAGC,UAAH,CAAcL,eAAA,CAAKC,IAAL,CAAUP,WAAV,EAAuB,kBAAvB,CAAd,CAHK,EAIL;MACA,MAAM,KAAIgB,uBAAJ,EAAiB,+CAAjB,CAAN;IACD;;IAEDN,kBAAA,CAAGU,QAAH,CAAYf,gBAAZ,EAA8BG,gBAA9B;;IACAL,uBAAuB,CAACkB,OAAxB,CAAgC,oBAAhC;EACD,CA1BD,CA0BE,OAAOC,CAAP,EAAe;IACfnB,uBAAuB,CAACoB,cAAxB,CAAuC;MACrCC,MAAM,EAAE,KAD6B;MAErCC,IAAI,EAAEC,gBAAA,CAAMC,MAAN,CAAa,+BAAb;IAF+B,CAAvC;;IAIAC,cAAA,CAAIC,MAAJ,CAAY,UAASP,CAAC,CAACQ,OAAQ,EAA/B;;IACAF,cAAA,CAAIC,MAAJ,CACG,8CAA6CH,gBAAA,CAAMK,IAAN,CAC5C,oBAD4C,CAE5C,6BAA4BL,gBAAA,CAAMM,GAAN,CAC5B,IAAAC,yBAAA,EAAU,gDAAV,CAD4B,CAE5B,EALJ;;IAOAL,cAAA,CAAIM,OAAJ;EACD;AACF"}