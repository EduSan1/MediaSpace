{"version":3,"file":"configureProjectAsync.js","names":["logConfig","config","isObjStr","str","test","Log","log","util","inspect","colors","compact","sorted","a","b","showHidden","depth","configureManagedProjectAsync","projectRoot","platforms","bundleIdentifier","includes","getOrPromptForBundleIdentifier","packageName","getOrPromptForPackage","exp","getPrebuildConfigAsync","expoUsername","getAccountUsername","compileModsAsync","assertMissingModProviders","isDebug","debug"],"sources":["../../../src/commands/eject/configureProjectAsync.ts"],"sourcesContent":["import { ExpoConfig, getAccountUsername, ProjectConfig } from '@expo/config';\nimport { compileModsAsync, ModPlatform } from '@expo/config-plugins';\nimport { getPrebuildConfigAsync } from '@expo/prebuild-config';\nimport util from 'util';\n\nimport Log from '../../log';\nimport {\n  getOrPromptForBundleIdentifier,\n  getOrPromptForPackage,\n} from '../utils/getOrPromptApplicationId';\n\nexport function logConfig(config: ExpoConfig | ProjectConfig) {\n  const isObjStr = (str: string): boolean => /^\\w+: {/g.test(str);\n  Log.log(\n    util.inspect(config, {\n      colors: true,\n      compact: false,\n      // Sort objects to the end so that smaller values aren't hidden between large objects.\n      sorted(a: string, b: string) {\n        if (isObjStr(a)) return 1;\n        if (isObjStr(b)) return -1;\n        return 0;\n      },\n      showHidden: false,\n      depth: null,\n    })\n  );\n}\n\nexport default async function configureManagedProjectAsync({\n  projectRoot,\n  platforms,\n}: {\n  projectRoot: string;\n  platforms: ModPlatform[];\n}) {\n  let bundleIdentifier: string | undefined;\n  if (platforms.includes('ios')) {\n    // Check bundle ID before reading the config because it may mutate the config if the user is prompted to define it.\n    bundleIdentifier = await getOrPromptForBundleIdentifier(projectRoot);\n  }\n  let packageName: string | undefined;\n  if (platforms.includes('android')) {\n    // Check package before reading the config because it may mutate the config if the user is prompted to define it.\n    packageName = await getOrPromptForPackage(projectRoot);\n  }\n\n  let { exp: config } = await getPrebuildConfigAsync(projectRoot, {\n    platforms,\n    packageName,\n    bundleIdentifier,\n    expoUsername(config) {\n      return getAccountUsername(config);\n    },\n  });\n\n  // compile all plugins and mods\n  config = await compileModsAsync(config, {\n    projectRoot,\n    platforms,\n    assertMissingModProviders: false,\n  });\n\n  if (Log.isDebug) {\n    Log.debug();\n    Log.debug('Evaluated config:');\n    logConfig(config);\n    Log.debug();\n  }\n\n  return config;\n}\n"],"mappings":";;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAKO,SAASA,SAAT,CAAmBC,MAAnB,EAAuD;EAC5D,MAAMC,QAAQ,GAAIC,GAAD,IAA0B,WAAWC,IAAX,CAAgBD,GAAhB,CAA3C;;EACAE,cAAA,CAAIC,GAAJ,CACEC,eAAA,CAAKC,OAAL,CAAaP,MAAb,EAAqB;IACnBQ,MAAM,EAAE,IADW;IAEnBC,OAAO,EAAE,KAFU;;IAGnB;IACAC,MAAM,CAACC,CAAD,EAAYC,CAAZ,EAAuB;MAC3B,IAAIX,QAAQ,CAACU,CAAD,CAAZ,EAAiB,OAAO,CAAP;MACjB,IAAIV,QAAQ,CAACW,CAAD,CAAZ,EAAiB,OAAO,CAAC,CAAR;MACjB,OAAO,CAAP;IACD,CARkB;;IASnBC,UAAU,EAAE,KATO;IAUnBC,KAAK,EAAE;EAVY,CAArB,CADF;AAcD;;AAEc,eAAeC,4BAAf,CAA4C;EACzDC,WADyD;EAEzDC;AAFyD,CAA5C,EAMZ;EACD,IAAIC,gBAAJ;;EACA,IAAID,SAAS,CAACE,QAAV,CAAmB,KAAnB,CAAJ,EAA+B;IAC7B;IACAD,gBAAgB,GAAG,MAAM,IAAAE,0DAAA,EAA+BJ,WAA/B,CAAzB;EACD;;EACD,IAAIK,WAAJ;;EACA,IAAIJ,SAAS,CAACE,QAAV,CAAmB,SAAnB,CAAJ,EAAmC;IACjC;IACAE,WAAW,GAAG,MAAM,IAAAC,iDAAA,EAAsBN,WAAtB,CAApB;EACD;;EAED,IAAI;IAAEO,GAAG,EAAEvB;EAAP,IAAkB,MAAM,IAAAwB,wCAAA,EAAuBR,WAAvB,EAAoC;IAC9DC,SAD8D;IAE9DI,WAF8D;IAG9DH,gBAH8D;;IAI9DO,YAAY,CAACzB,MAAD,EAAS;MACnB,OAAO,IAAA0B,4BAAA,EAAmB1B,MAAnB,CAAP;IACD;;EAN6D,CAApC,CAA5B,CAZC,CAqBD;;EACAA,MAAM,GAAG,MAAM,IAAA2B,iCAAA,EAAiB3B,MAAjB,EAAyB;IACtCgB,WADsC;IAEtCC,SAFsC;IAGtCW,yBAAyB,EAAE;EAHW,CAAzB,CAAf;;EAMA,IAAIxB,cAAA,CAAIyB,OAAR,EAAiB;IACfzB,cAAA,CAAI0B,KAAJ;;IACA1B,cAAA,CAAI0B,KAAJ,CAAU,mBAAV;;IACA/B,SAAS,CAACC,MAAD,CAAT;;IACAI,cAAA,CAAI0B,KAAJ;EACD;;EAED,OAAO9B,MAAP;AACD"}