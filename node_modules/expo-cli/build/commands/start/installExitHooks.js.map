{"version":3,"file":"installExitHooks.js","names":["installExitHooks","projectRoot","killSignals","signal","process","on","currentSpinner","Log","getSpinner","fail","setSpinner","currentProgress","getProgress","terminate","setBundleProgressBar","spinner","ora","text","color","start","Project","stopAsync","then","stopAndPersist","symbol","exit","catch","error","installCustomExitHook","listener"],"sources":["../../../src/commands/start/installExitHooks.ts"],"sourcesContent":["import { Project } from 'xdl';\n\nimport Log from '../../log';\nimport { ora } from '../../utils/ora';\n\nexport function installExitHooks(projectRoot: string): void {\n  const killSignals: ['SIGINT', 'SIGTERM'] = ['SIGINT', 'SIGTERM'];\n  for (const signal of killSignals) {\n    process.on(signal, () => {\n      const currentSpinner = Log.getSpinner();\n      if (currentSpinner) {\n        currentSpinner.fail();\n        Log.setSpinner(null);\n      }\n      const currentProgress = Log.getProgress();\n      if (currentProgress) {\n        currentProgress.terminate();\n        Log.setBundleProgressBar(null);\n      }\n      const spinner = ora({ text: 'Stopping server', color: 'white' }).start();\n      Log.setSpinner(spinner);\n      Project.stopAsync(projectRoot)\n        .then(() => {\n          spinner.stopAndPersist({ text: 'Stopped server', symbol: `\\u203A` });\n          process.exit();\n        })\n        .catch(error => {\n          spinner.fail('Failed to stop server');\n          Log.error(error);\n        });\n    });\n  }\n}\n\nexport function installCustomExitHook(listener: NodeJS.SignalsListener) {\n  const killSignals: ['SIGINT', 'SIGTERM'] = ['SIGINT', 'SIGTERM'];\n  for (const signal of killSignals) {\n    process.on(signal, listener);\n  }\n}\n"],"mappings":";;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAEO,SAASA,gBAAT,CAA0BC,WAA1B,EAAqD;EAC1D,MAAMC,WAAkC,GAAG,CAAC,QAAD,EAAW,SAAX,CAA3C;;EACA,KAAK,MAAMC,MAAX,IAAqBD,WAArB,EAAkC;IAChCE,OAAO,CAACC,EAAR,CAAWF,MAAX,EAAmB,MAAM;MACvB,MAAMG,cAAc,GAAGC,cAAA,CAAIC,UAAJ,EAAvB;;MACA,IAAIF,cAAJ,EAAoB;QAClBA,cAAc,CAACG,IAAf;;QACAF,cAAA,CAAIG,UAAJ,CAAe,IAAf;MACD;;MACD,MAAMC,eAAe,GAAGJ,cAAA,CAAIK,WAAJ,EAAxB;;MACA,IAAID,eAAJ,EAAqB;QACnBA,eAAe,CAACE,SAAhB;;QACAN,cAAA,CAAIO,oBAAJ,CAAyB,IAAzB;MACD;;MACD,MAAMC,OAAO,GAAG,IAAAC,UAAA,EAAI;QAAEC,IAAI,EAAE,iBAAR;QAA2BC,KAAK,EAAE;MAAlC,CAAJ,EAAiDC,KAAjD,EAAhB;;MACAZ,cAAA,CAAIG,UAAJ,CAAeK,OAAf;;MACAK,cAAA,CAAQC,SAAR,CAAkBpB,WAAlB,EACGqB,IADH,CACQ,MAAM;QACVP,OAAO,CAACQ,cAAR,CAAuB;UAAEN,IAAI,EAAE,gBAAR;UAA0BO,MAAM,EAAG;QAAnC,CAAvB;QACApB,OAAO,CAACqB,IAAR;MACD,CAJH,EAKGC,KALH,CAKSC,KAAK,IAAI;QACdZ,OAAO,CAACN,IAAR,CAAa,uBAAb;;QACAF,cAAA,CAAIoB,KAAJ,CAAUA,KAAV;MACD,CARH;IASD,CAtBD;EAuBD;AACF;;AAEM,SAASC,qBAAT,CAA+BC,QAA/B,EAAiE;EACtE,MAAM3B,WAAkC,GAAG,CAAC,QAAD,EAAW,SAAX,CAA3C;;EACA,KAAK,MAAMC,MAAX,IAAqBD,WAArB,EAAkC;IAChCE,OAAO,CAACC,EAAR,CAAWF,MAAX,EAAmB0B,QAAnB;EACD;AACF"}