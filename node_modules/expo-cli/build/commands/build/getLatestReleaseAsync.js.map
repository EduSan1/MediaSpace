{"version":3,"file":"getLatestReleaseAsync.js","names":["getLatestReleaseAsync","projectRoot","options","user","UserManager","ensureLoggedInAsync","api","ApiV2","clientForUser","exp","getConfig","skipSDKVersionRequirement","result","postAsync","owner","slug","releaseChannel","count","platform","queryResult","length"],"sources":["../../../src/commands/build/getLatestReleaseAsync.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport { ApiV2, UserManager } from 'xdl';\n\ntype Release = {\n  fullName: string;\n  channel: string;\n  channelId: string;\n  publicationId: string;\n  appVersion: string;\n  sdkVersion: string;\n  publishedTime: string;\n  platform: string;\n};\n\nexport async function getLatestReleaseAsync(\n  projectRoot: string,\n  options: {\n    releaseChannel: string;\n    platform: string;\n    owner?: string;\n  }\n): Promise<Release | null> {\n  const user = await UserManager.ensureLoggedInAsync();\n  const api = ApiV2.clientForUser(user);\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  const result = await api.postAsync('publish/history', {\n    owner: options.owner,\n    slug: exp.slug,\n    releaseChannel: options.releaseChannel,\n    count: 1,\n    platform: options.platform,\n  });\n  const { queryResult } = result;\n  if (queryResult && queryResult.length > 0) {\n    return queryResult[0];\n  } else {\n    return null;\n  }\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAaO,eAAeA,qBAAf,CACLC,WADK,EAELC,OAFK,EAOoB;EACzB,MAAMC,IAAI,GAAG,MAAMC,kBAAA,CAAYC,mBAAZ,EAAnB;;EACA,MAAMC,GAAG,GAAGC,YAAA,CAAMC,aAAN,CAAoBL,IAApB,CAAZ;;EACA,MAAM;IAAEM;EAAF,IAAU,IAAAC,mBAAA,EAAUT,WAAV,EAAuB;IAAEU,yBAAyB,EAAE;EAA7B,CAAvB,CAAhB;EACA,MAAMC,MAAM,GAAG,MAAMN,GAAG,CAACO,SAAJ,CAAc,iBAAd,EAAiC;IACpDC,KAAK,EAAEZ,OAAO,CAACY,KADqC;IAEpDC,IAAI,EAAEN,GAAG,CAACM,IAF0C;IAGpDC,cAAc,EAAEd,OAAO,CAACc,cAH4B;IAIpDC,KAAK,EAAE,CAJ6C;IAKpDC,QAAQ,EAAEhB,OAAO,CAACgB;EALkC,CAAjC,CAArB;EAOA,MAAM;IAAEC;EAAF,IAAkBP,MAAxB;;EACA,IAAIO,WAAW,IAAIA,WAAW,CAACC,MAAZ,GAAqB,CAAxC,EAA2C;IACzC,OAAOD,WAAW,CAAC,CAAD,CAAlB;EACD,CAFD,MAEO;IACL,OAAO,IAAP;EACD;AACF"}