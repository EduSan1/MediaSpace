{"version":3,"file":"getBuildStatusAsync.js","names":["getBuildStatusAsync","projectRoot","options","user","UserManager","ensureLoggedInAsync","validateOptions","exp","getExpAsync","api","ApiV2","clientForUser","postAsync","manifest"],"sources":["../../../src/commands/build/getBuildStatusAsync.ts"],"sourcesContent":["import { ApiV2, UserManager } from 'xdl';\n\nimport { getExpAsync, GetExpConfigOptions, validateOptions } from './startBuildAsync';\n\ntype JobState = 'pending' | 'started' | 'in-progress' | 'finished' | 'errored' | 'sent-to-queue';\n\nexport type TurtleMode = 'normal' | 'high' | 'high_only';\n\n// https://github.com/expo/universe/blob/283efaba3acfdefdc7db12f649516b6d6a94bec4/server/www/src/data/entities/builds/BuildJobEntity.ts#L25-L56\nexport interface BuildJobFields {\n  id: string;\n  experienceName: string;\n  status: JobState;\n  platform: 'ios' | 'android';\n  userId: string | null;\n  experienceId: string;\n  artifactId: string | null;\n  nonce: string | null;\n  artifacts: {\n    url?: string;\n    manifestPlistUrl?: string;\n  } | null;\n  config: {\n    buildType?: string;\n    releaseChannel?: string;\n    bundleIdentifier?: string;\n  };\n  logs: object | null;\n  extraData: {\n    request_id?: string;\n    turtleMode?: TurtleMode;\n  } | null;\n  created: Date;\n  updated: Date;\n  expirationDate: Date;\n  sdkVersion: string | null;\n  turtleVersion: string | null;\n  buildDuration: number | null;\n  priority: string;\n  accountId: string | null;\n}\n\nexport type BuildStatusResult = {\n  jobs?: BuildJobFields[];\n  err?: null;\n  userHasBuiltAppBefore: boolean;\n  userHasBuiltExperienceBefore: boolean;\n  canPurchasePriorityBuilds?: boolean;\n  numberOfRemainingPriorityBuilds?: number;\n  hasUnlimitedPriorityBuilds?: boolean;\n};\n\nexport async function getBuildStatusAsync(\n  projectRoot: string,\n  options: GetExpConfigOptions = {}\n): Promise<BuildStatusResult> {\n  const user = await UserManager.ensureLoggedInAsync();\n\n  validateOptions(options);\n  const { exp } = await getExpAsync(projectRoot, options);\n\n  const api = ApiV2.clientForUser(user);\n  return await api.postAsync('build/status', { manifest: exp, options });\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAkDO,eAAeA,mBAAf,CACLC,WADK,EAELC,OAA4B,GAAG,EAF1B,EAGuB;EAC5B,MAAMC,IAAI,GAAG,MAAMC,kBAAA,CAAYC,mBAAZ,EAAnB;EAEA,IAAAC,kCAAA,EAAgBJ,OAAhB;EACA,MAAM;IAAEK;EAAF,IAAU,MAAM,IAAAC,8BAAA,EAAYP,WAAZ,EAAyBC,OAAzB,CAAtB;;EAEA,MAAMO,GAAG,GAAGC,YAAA,CAAMC,aAAN,CAAoBR,IAApB,CAAZ;;EACA,OAAO,MAAMM,GAAG,CAACG,SAAJ,CAAc,cAAd,EAA8B;IAAEC,QAAQ,EAAEN,GAAZ;IAAiBL;EAAjB,CAA9B,CAAb;AACD"}