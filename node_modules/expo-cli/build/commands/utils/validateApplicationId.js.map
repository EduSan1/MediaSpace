{"version":3,"file":"validateApplicationId.js","names":["validateBundleId","value","test","validatePackage","cachedBundleIdResults","cachedPackageNameResults","getBundleIdWarningAsync","bundleId","isUrlAvailableAsync","url","response","fetch","json","resultCount","firstApp","results","message","formatInUseWarning","trackName","sellerName","getPackageNameWarningAsync","packageName","status","chalk","bold","dim","learnMore","appName","author","id","italic"],"sources":["../../../src/commands/utils/validateApplicationId.ts"],"sourcesContent":["import chalk from 'chalk';\nimport fetch from 'node-fetch';\n\nimport { learnMore } from './TerminalLink';\nimport { isUrlAvailableAsync } from './url';\n\nexport function validateBundleId(value: string): boolean {\n  return /^[a-zA-Z0-9-.]+$/.test(value);\n}\n\nexport function validatePackage(value: string): boolean {\n  return /^[a-zA-Z][a-zA-Z0-9_]*(\\.[a-zA-Z][a-zA-Z0-9_]*)+$/.test(value);\n}\n\nconst cachedBundleIdResults: Record<string, string> = {};\nconst cachedPackageNameResults: Record<string, string> = {};\n\n/**\n * A quality of life method that provides a warning when the bundle ID is already in use.\n *\n * @param bundleId\n */\nexport async function getBundleIdWarningAsync(bundleId: string): Promise<string | null> {\n  // Prevent fetching for the same ID multiple times.\n  if (cachedBundleIdResults[bundleId]) {\n    return cachedBundleIdResults[bundleId];\n  }\n\n  if (!(await isUrlAvailableAsync('itunes.apple.com'))) {\n    // If no network, simply skip the warnings since they'll just lead to more confusion.\n    return null;\n  }\n\n  const url = `http://itunes.apple.com/lookup?bundleId=${bundleId}`;\n  try {\n    const response = await fetch(url);\n    const json = await response.json();\n    if (json.resultCount > 0) {\n      const firstApp = json.results[0];\n      const message = formatInUseWarning(firstApp.trackName, firstApp.sellerName, bundleId);\n      cachedBundleIdResults[bundleId] = message;\n      return message;\n    }\n  } catch {\n    // Error fetching itunes data.\n  }\n  return null;\n}\n\nexport async function getPackageNameWarningAsync(packageName: string): Promise<string | null> {\n  // Prevent fetching for the same ID multiple times.\n  if (cachedPackageNameResults[packageName]) {\n    return cachedPackageNameResults[packageName];\n  }\n\n  if (!(await isUrlAvailableAsync('play.google.com'))) {\n    // If no network, simply skip the warnings since they'll just lead to more confusion.\n    return null;\n  }\n\n  const url = `https://play.google.com/store/apps/details?id=${packageName}`;\n  try {\n    const response = await fetch(url);\n    // If the page exists, then warn the user.\n    if (response.status === 200) {\n      // There is no JSON API for the Play Store so we can't concisely\n      // locate the app name and developer to match the iOS warning.\n      const message = `⚠️  The package ${chalk.bold(packageName)} is already in use. ${chalk.dim(\n        learnMore(url)\n      )}`;\n      cachedPackageNameResults[packageName] = message;\n      return message;\n    }\n  } catch {\n    // Error fetching play store data or the page doesn't exist.\n  }\n  return null;\n}\n\nfunction formatInUseWarning(appName: string, author: string, id: string): string {\n  return `⚠️  The app ${chalk.bold(appName)} by ${chalk.italic(\n    author\n  )} is already using ${chalk.bold(id)}`;\n}\n"],"mappings":";;;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAEO,SAASA,gBAAT,CAA0BC,KAA1B,EAAkD;EACvD,OAAO,mBAAmBC,IAAnB,CAAwBD,KAAxB,CAAP;AACD;;AAEM,SAASE,eAAT,CAAyBF,KAAzB,EAAiD;EACtD,OAAO,oDAAoDC,IAApD,CAAyDD,KAAzD,CAAP;AACD;;AAED,MAAMG,qBAA6C,GAAG,EAAtD;AACA,MAAMC,wBAAgD,GAAG,EAAzD;AAEA;AACA;AACA;AACA;AACA;;AACO,eAAeC,uBAAf,CAAuCC,QAAvC,EAAiF;EACtF;EACA,IAAIH,qBAAqB,CAACG,QAAD,CAAzB,EAAqC;IACnC,OAAOH,qBAAqB,CAACG,QAAD,CAA5B;EACD;;EAED,IAAI,EAAE,MAAM,IAAAC,0BAAA,EAAoB,kBAApB,CAAR,CAAJ,EAAsD;IACpD;IACA,OAAO,IAAP;EACD;;EAED,MAAMC,GAAG,GAAI,2CAA0CF,QAAS,EAAhE;;EACA,IAAI;IACF,MAAMG,QAAQ,GAAG,MAAM,IAAAC,oBAAA,EAAMF,GAAN,CAAvB;IACA,MAAMG,IAAI,GAAG,MAAMF,QAAQ,CAACE,IAAT,EAAnB;;IACA,IAAIA,IAAI,CAACC,WAAL,GAAmB,CAAvB,EAA0B;MACxB,MAAMC,QAAQ,GAAGF,IAAI,CAACG,OAAL,CAAa,CAAb,CAAjB;MACA,MAAMC,OAAO,GAAGC,kBAAkB,CAACH,QAAQ,CAACI,SAAV,EAAqBJ,QAAQ,CAACK,UAA9B,EAA0CZ,QAA1C,CAAlC;MACAH,qBAAqB,CAACG,QAAD,CAArB,GAAkCS,OAAlC;MACA,OAAOA,OAAP;IACD;EACF,CATD,CASE,MAAM,CACN;EACD;;EACD,OAAO,IAAP;AACD;;AAEM,eAAeI,0BAAf,CAA0CC,WAA1C,EAAuF;EAC5F;EACA,IAAIhB,wBAAwB,CAACgB,WAAD,CAA5B,EAA2C;IACzC,OAAOhB,wBAAwB,CAACgB,WAAD,CAA/B;EACD;;EAED,IAAI,EAAE,MAAM,IAAAb,0BAAA,EAAoB,iBAApB,CAAR,CAAJ,EAAqD;IACnD;IACA,OAAO,IAAP;EACD;;EAED,MAAMC,GAAG,GAAI,iDAAgDY,WAAY,EAAzE;;EACA,IAAI;IACF,MAAMX,QAAQ,GAAG,MAAM,IAAAC,oBAAA,EAAMF,GAAN,CAAvB,CADE,CAEF;;IACA,IAAIC,QAAQ,CAACY,MAAT,KAAoB,GAAxB,EAA6B;MAC3B;MACA;MACA,MAAMN,OAAO,GAAI,mBAAkBO,gBAAA,CAAMC,IAAN,CAAWH,WAAX,CAAwB,uBAAsBE,gBAAA,CAAME,GAAN,CAC/E,IAAAC,yBAAA,EAAUjB,GAAV,CAD+E,CAE/E,EAFF;MAGAJ,wBAAwB,CAACgB,WAAD,CAAxB,GAAwCL,OAAxC;MACA,OAAOA,OAAP;IACD;EACF,CAZD,CAYE,MAAM,CACN;EACD;;EACD,OAAO,IAAP;AACD;;AAED,SAASC,kBAAT,CAA4BU,OAA5B,EAA6CC,MAA7C,EAA6DC,EAA7D,EAAiF;EAC/E,OAAQ,eAAcN,gBAAA,CAAMC,IAAN,CAAWG,OAAX,CAAoB,OAAMJ,gBAAA,CAAMO,MAAN,CAC9CF,MAD8C,CAE9C,qBAAoBL,gBAAA,CAAMC,IAAN,CAAWK,EAAX,CAAe,EAFrC;AAGD"}