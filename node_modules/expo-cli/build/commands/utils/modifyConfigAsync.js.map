{"version":3,"file":"modifyConfigAsync.js","names":["attemptModification","projectRoot","edits","exactEdits","modification","modifyConfigAsync","skipSDKVersionRequirement","type","Log","addNewLineIfNone","warnAboutConfigAndThrow","message","logNoConfig","log","chalk","yellow","bold","attemptAddingPluginsAsync","exp","plugins","length","Set","concat","skipPlugins","join","notifyAboutManualConfigEdits","SilentError","cyan","newLine","JSON","stringify"],"sources":["../../../src/commands/utils/modifyConfigAsync.ts"],"sourcesContent":["import { ExpoConfig, modifyConfigAsync } from '@expo/config';\nimport chalk from 'chalk';\n\nimport { SilentError } from '../../CommandError';\nimport Log from '../../log';\n\nexport async function attemptModification(\n  projectRoot: string,\n  edits: Partial<ExpoConfig>,\n  exactEdits: Partial<ExpoConfig>\n): Promise<void> {\n  const modification = await modifyConfigAsync(projectRoot, edits, {\n    skipSDKVersionRequirement: true,\n  });\n  if (modification.type === 'success') {\n    Log.addNewLineIfNone();\n  } else {\n    warnAboutConfigAndThrow(modification.type, modification.message!, exactEdits);\n  }\n}\n\nfunction logNoConfig() {\n  Log.log(\n    chalk.yellow(\n      `No Expo config was found. Please create an Expo config (${chalk.bold`app.json`} or ${chalk.bold`app.config.js`}) in your project root.`\n    )\n  );\n}\n\nexport async function attemptAddingPluginsAsync(\n  projectRoot: string,\n  exp: Pick<ExpoConfig, 'plugins'>,\n  plugins: string[]\n): Promise<void> {\n  if (!plugins.length) return;\n\n  const edits = {\n    plugins: [...new Set((exp.plugins || []).concat(plugins))],\n  };\n  const modification = await modifyConfigAsync(projectRoot, edits, {\n    skipSDKVersionRequirement: true,\n    skipPlugins: true,\n  });\n  if (modification.type === 'success') {\n    Log.log(`\\u203A Added config plugin${plugins.length === 1 ? '' : 's'}: ${plugins.join(', ')}`);\n  } else {\n    const exactEdits = {\n      plugins,\n    };\n    warnAboutConfigAndThrow(modification.type, modification.message!, exactEdits);\n  }\n}\n\nexport function warnAboutConfigAndThrow(type: string, message: string, edits: Partial<ExpoConfig>) {\n  Log.addNewLineIfNone();\n  if (type === 'warn') {\n    // The project is using a dynamic config, give the user a helpful log and bail out.\n    Log.log(chalk.yellow(message));\n  } else {\n    logNoConfig();\n  }\n\n  notifyAboutManualConfigEdits(edits);\n  throw new SilentError();\n}\n\nfunction notifyAboutManualConfigEdits(edits: Partial<ExpoConfig>) {\n  Log.log(chalk.cyan(`Please add the following to your Expo config`));\n  Log.newLine();\n  Log.log(JSON.stringify(edits, null, 2));\n  Log.newLine();\n}\n"],"mappings":";;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAEO,eAAeA,mBAAf,CACLC,WADK,EAELC,KAFK,EAGLC,UAHK,EAIU;EACf,MAAMC,YAAY,GAAG,MAAM,IAAAC,2BAAA,EAAkBJ,WAAlB,EAA+BC,KAA/B,EAAsC;IAC/DI,yBAAyB,EAAE;EADoC,CAAtC,CAA3B;;EAGA,IAAIF,YAAY,CAACG,IAAb,KAAsB,SAA1B,EAAqC;IACnCC,cAAA,CAAIC,gBAAJ;EACD,CAFD,MAEO;IACLC,uBAAuB,CAACN,YAAY,CAACG,IAAd,EAAoBH,YAAY,CAACO,OAAjC,EAA2CR,UAA3C,CAAvB;EACD;AACF;;AAED,SAASS,WAAT,GAAuB;EACrBJ,cAAA,CAAIK,GAAJ,CACEC,gBAAA,CAAMC,MAAN,CACG,2DAA0DD,gBAAA,CAAME,IAAK,UAAU,OAAMF,gBAAA,CAAME,IAAK,eAAe,yBADlH,CADF;AAKD;;AAEM,eAAeC,yBAAf,CACLhB,WADK,EAELiB,GAFK,EAGLC,OAHK,EAIU;EACf,IAAI,CAACA,OAAO,CAACC,MAAb,EAAqB;EAErB,MAAMlB,KAAK,GAAG;IACZiB,OAAO,EAAE,CAAC,GAAG,IAAIE,GAAJ,CAAQ,CAACH,GAAG,CAACC,OAAJ,IAAe,EAAhB,EAAoBG,MAApB,CAA2BH,OAA3B,CAAR,CAAJ;EADG,CAAd;EAGA,MAAMf,YAAY,GAAG,MAAM,IAAAC,2BAAA,EAAkBJ,WAAlB,EAA+BC,KAA/B,EAAsC;IAC/DI,yBAAyB,EAAE,IADoC;IAE/DiB,WAAW,EAAE;EAFkD,CAAtC,CAA3B;;EAIA,IAAInB,YAAY,CAACG,IAAb,KAAsB,SAA1B,EAAqC;IACnCC,cAAA,CAAIK,GAAJ,CAAS,6BAA4BM,OAAO,CAACC,MAAR,KAAmB,CAAnB,GAAuB,EAAvB,GAA4B,GAAI,KAAID,OAAO,CAACK,IAAR,CAAa,IAAb,CAAmB,EAA5F;EACD,CAFD,MAEO;IACL,MAAMrB,UAAU,GAAG;MACjBgB;IADiB,CAAnB;IAGAT,uBAAuB,CAACN,YAAY,CAACG,IAAd,EAAoBH,YAAY,CAACO,OAAjC,EAA2CR,UAA3C,CAAvB;EACD;AACF;;AAEM,SAASO,uBAAT,CAAiCH,IAAjC,EAA+CI,OAA/C,EAAgET,KAAhE,EAA4F;EACjGM,cAAA,CAAIC,gBAAJ;;EACA,IAAIF,IAAI,KAAK,MAAb,EAAqB;IACnB;IACAC,cAAA,CAAIK,GAAJ,CAAQC,gBAAA,CAAMC,MAAN,CAAaJ,OAAb,CAAR;EACD,CAHD,MAGO;IACLC,WAAW;EACZ;;EAEDa,4BAA4B,CAACvB,KAAD,CAA5B;EACA,MAAM,KAAIwB,2BAAJ,GAAN;AACD;;AAED,SAASD,4BAAT,CAAsCvB,KAAtC,EAAkE;EAChEM,cAAA,CAAIK,GAAJ,CAAQC,gBAAA,CAAMa,IAAN,CAAY,8CAAZ,CAAR;;EACAnB,cAAA,CAAIoB,OAAJ;;EACApB,cAAA,CAAIK,GAAJ,CAAQgB,IAAI,CAACC,SAAL,CAAe5B,KAAf,EAAsB,IAAtB,EAA4B,CAA5B,CAAR;;EACAM,cAAA,CAAIoB,OAAJ;AACD"}