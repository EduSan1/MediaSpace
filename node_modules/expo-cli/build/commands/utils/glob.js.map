{"version":3,"file":"glob.js","names":["everyMatchAsync","pattern","options","Promise","resolve","reject","g","Glob","called","callback","er","matched","on","matches","anyMatchAsync","wrapGlobWithTimeout","query","duration","timeout","setTimeout","process","clearTimeout","error"],"sources":["../../../src/commands/utils/glob.ts"],"sourcesContent":["import G, { Glob } from 'glob';\n\nexport function everyMatchAsync(pattern: string, options: G.IOptions) {\n  return new Promise<string[]>((resolve, reject) => {\n    const g = new Glob(pattern, options);\n    let called = false;\n    const callback = (er: Error | null, matched: string[]) => {\n      if (called) return;\n      called = true;\n      if (er) reject(er);\n      else resolve(matched);\n    };\n    g.on('error', callback);\n    g.on('end', matches => callback(null, matches));\n  });\n}\n\nexport function anyMatchAsync(pattern: string, options: G.IOptions) {\n  return new Promise<string[]>((resolve, reject) => {\n    const g = new Glob(pattern, options);\n    let called = false;\n    const callback = (er: Error | null, matched: string[]) => {\n      if (called) return;\n      called = true;\n      if (er) reject(er);\n      else resolve(matched);\n    };\n    g.on('error', callback);\n    g.on('match', matched => {\n      // We've disabled using abort as it breaks the entire glob package across all instances.\n      // https://github.com/isaacs/node-glob/issues/279 & https://github.com/isaacs/node-glob/issues/342\n      // For now, just collect every match.\n      // g.abort();\n      callback(null, [matched]);\n    });\n    g.on('end', matches => callback(null, matches));\n  });\n}\n\nexport function wrapGlobWithTimeout(\n  query: () => Promise<string[]>,\n  duration: number\n): Promise<string[] | false> {\n  return new Promise(async (resolve, reject) => {\n    // Wait some time, then escape...\n    // Adding this because glob can sometimes freeze and fail to resolve if any other glob uses `.abort()`.\n    const timeout = setTimeout(() => {\n      resolve(false);\n    }, duration);\n\n    process.on('SIGINT', () => clearTimeout(timeout));\n\n    try {\n      resolve(await query());\n    } catch (error: any) {\n      reject(error);\n    } finally {\n      clearTimeout(timeout);\n    }\n  });\n}\n"],"mappings":";;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEO,SAASA,eAAT,CAAyBC,OAAzB,EAA0CC,OAA1C,EAA+D;EACpE,OAAO,IAAIC,OAAJ,CAAsB,CAACC,OAAD,EAAUC,MAAV,KAAqB;IAChD,MAAMC,CAAC,GAAG,KAAIC,YAAJ,EAASN,OAAT,EAAkBC,OAAlB,CAAV;IACA,IAAIM,MAAM,GAAG,KAAb;;IACA,MAAMC,QAAQ,GAAG,CAACC,EAAD,EAAmBC,OAAnB,KAAyC;MACxD,IAAIH,MAAJ,EAAY;MACZA,MAAM,GAAG,IAAT;MACA,IAAIE,EAAJ,EAAQL,MAAM,CAACK,EAAD,CAAN,CAAR,KACKN,OAAO,CAACO,OAAD,CAAP;IACN,CALD;;IAMAL,CAAC,CAACM,EAAF,CAAK,OAAL,EAAcH,QAAd;IACAH,CAAC,CAACM,EAAF,CAAK,KAAL,EAAYC,OAAO,IAAIJ,QAAQ,CAAC,IAAD,EAAOI,OAAP,CAA/B;EACD,CAXM,CAAP;AAYD;;AAEM,SAASC,aAAT,CAAuBb,OAAvB,EAAwCC,OAAxC,EAA6D;EAClE,OAAO,IAAIC,OAAJ,CAAsB,CAACC,OAAD,EAAUC,MAAV,KAAqB;IAChD,MAAMC,CAAC,GAAG,KAAIC,YAAJ,EAASN,OAAT,EAAkBC,OAAlB,CAAV;IACA,IAAIM,MAAM,GAAG,KAAb;;IACA,MAAMC,QAAQ,GAAG,CAACC,EAAD,EAAmBC,OAAnB,KAAyC;MACxD,IAAIH,MAAJ,EAAY;MACZA,MAAM,GAAG,IAAT;MACA,IAAIE,EAAJ,EAAQL,MAAM,CAACK,EAAD,CAAN,CAAR,KACKN,OAAO,CAACO,OAAD,CAAP;IACN,CALD;;IAMAL,CAAC,CAACM,EAAF,CAAK,OAAL,EAAcH,QAAd;IACAH,CAAC,CAACM,EAAF,CAAK,OAAL,EAAcD,OAAO,IAAI;MACvB;MACA;MACA;MACA;MACAF,QAAQ,CAAC,IAAD,EAAO,CAACE,OAAD,CAAP,CAAR;IACD,CAND;IAOAL,CAAC,CAACM,EAAF,CAAK,KAAL,EAAYC,OAAO,IAAIJ,QAAQ,CAAC,IAAD,EAAOI,OAAP,CAA/B;EACD,CAlBM,CAAP;AAmBD;;AAEM,SAASE,mBAAT,CACLC,KADK,EAELC,QAFK,EAGsB;EAC3B,OAAO,IAAId,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;IAC5C;IACA;IACA,MAAMa,OAAO,GAAGC,UAAU,CAAC,MAAM;MAC/Bf,OAAO,CAAC,KAAD,CAAP;IACD,CAFyB,EAEvBa,QAFuB,CAA1B;IAIAG,OAAO,CAACR,EAAR,CAAW,QAAX,EAAqB,MAAMS,YAAY,CAACH,OAAD,CAAvC;;IAEA,IAAI;MACFd,OAAO,CAAC,MAAMY,KAAK,EAAZ,CAAP;IACD,CAFD,CAEE,OAAOM,KAAP,EAAmB;MACnBjB,MAAM,CAACiB,KAAD,CAAN;IACD,CAJD,SAIU;MACRD,YAAY,CAACH,OAAD,CAAZ;IACD;EACF,CAhBM,CAAP;AAiBD"}