{"version":3,"file":"ClientUpgradeUtils.js","names":["getExpoSdkConfig","path","projectRoot","findProjectRootAsync","exp","getConfig","skipSDKVersionRequirement","error","code","undefined","getClient","platform","sdk","androidClientUrl","url","version","androidClientVersion","iosClientUrl","iosClientVersion","getAvailableClients","options","Object","keys","sdkVersions","reverse","map","client","sdkVersionString","sdkVersion","clientUrl","clientVersion","filter","hasUrl","isDeprecated","IsCompatible","project","Versions","lteSdkVersion","askClientToInstall","answer","prompt","type","name","message","optionsPerPage","choices","clients","clientLabels","latestSdkVersion","currentSdkVersion","Boolean","clientMessage","length","join","value","title","chalk","bold","gray","targetClient"],"sources":["../../../src/commands/utils/ClientUpgradeUtils.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport { ExpoConfig } from '@expo/config-types';\nimport chalk from 'chalk';\nimport { Versions } from 'xdl';\n\nimport prompt from '../../utils/prompts';\nimport { findProjectRootAsync } from './ProjectUtils';\n\nexport async function getExpoSdkConfig(path: string) {\n  try {\n    const { projectRoot } = await findProjectRootAsync(path);\n    const { exp } = getConfig(projectRoot, {\n      skipSDKVersionRequirement: true,\n    });\n    return exp;\n  } catch (error: any) {\n    if (error.code !== 'NO_PROJECT') {\n      throw error;\n    }\n  }\n  return undefined;\n}\n\ntype ClientPlatform = 'android' | 'ios';\n\nexport function getClient(platform: ClientPlatform, sdk?: Versions.SDKVersion | null) {\n  if (!sdk) {\n    return null;\n  }\n\n  if (platform === 'android' && sdk.androidClientUrl) {\n    return {\n      url: sdk.androidClientUrl,\n      version: sdk.androidClientVersion,\n    };\n  }\n\n  if (platform === 'ios' && sdk.iosClientUrl) {\n    return {\n      url: sdk.iosClientUrl,\n      version: sdk.iosClientVersion,\n    };\n  }\n\n  return null;\n}\n\ninterface AvailableClientOptions {\n  sdkVersions: Versions.SDKVersions;\n  platform: ClientPlatform;\n  project?: ExpoConfig;\n}\n\ninterface AvailableClient {\n  sdkVersion: Versions.SDKVersion;\n  sdkVersionString: string;\n  clientUrl?: string;\n  clientVersion?: string;\n}\n\nexport function getAvailableClients(options: AvailableClientOptions): AvailableClient[] {\n  return Object.keys(options.sdkVersions)\n    .reverse()\n    .map(version => {\n      const client = getClient(options.platform, options.sdkVersions[version]);\n\n      return {\n        sdkVersionString: version,\n        sdkVersion: options.sdkVersions[version],\n        clientUrl: client?.url,\n        clientVersion: client?.version,\n      };\n    })\n    .filter(client => {\n      const hasUrl = !!client.clientUrl;\n      const isDeprecated = !!client.sdkVersion.isDeprecated;\n      const IsCompatible = options.project\n        ? Versions.lteSdkVersion(options.project, client.sdkVersionString)\n        : true;\n\n      return !isDeprecated && IsCompatible && hasUrl;\n    });\n}\n\ninterface InstallClientOptions {\n  clients: AvailableClient[];\n  latestSdkVersion?: string;\n  currentSdkVersion?: string;\n}\n\nexport async function askClientToInstall(options: InstallClientOptions): Promise<AvailableClient> {\n  const answer = await prompt({\n    type: 'select',\n    name: 'targetClient',\n    message: 'Choose an SDK version to install the client for:',\n    optionsPerPage: 20,\n    choices: options.clients.map(client => {\n      const clientVersion = `- client ${client.clientVersion || 'version unknown'}`;\n      const clientLabels = [\n        client.sdkVersionString === options.latestSdkVersion && 'latest',\n        client.sdkVersionString === options.currentSdkVersion && 'recommended',\n      ].filter(Boolean);\n\n      const clientMessage = clientLabels.length\n        ? `${clientVersion} (${clientLabels.join(', ')})`\n        : clientVersion;\n\n      return {\n        value: client,\n        title: `${chalk.bold(client.sdkVersionString)} ${chalk.gray(clientMessage)}`,\n      };\n    }),\n  });\n\n  return answer.targetClient;\n}\n"],"mappings":"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"}