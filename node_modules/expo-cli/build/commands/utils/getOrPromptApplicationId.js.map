{"version":3,"file":"getOrPromptApplicationId.js","names":["noBundleIdMessage","noPackageMessage","getOrPromptForBundleIdentifier","projectRoot","exp","getConfig","skipSDKVersionRequirement","currentBundleId","ios","bundleIdentifier","validateBundleId","CommandError","recommendedBundleId","android","package","username","owner","UserManager","getCurrentUsernameAsync","possibleId","slug","Log","addNewLineIfNone","log","chalk","bold","dim","learnMore","newLine","prompt","type","name","initial","message","validate","nonInteractiveHelp","warning","getBundleIdWarningAsync","nestedWarn","confirmAsync","attemptModification","getOrPromptForPackage","currentPackage","validatePackage","recommendedPackage","split","join","packageName","getPackageNameWarningAsync"],"sources":["../../../src/commands/utils/getOrPromptApplicationId.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport { UserManager } from 'xdl';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport prompt, { confirmAsync } from '../../utils/prompts';\nimport { learnMore } from './TerminalLink';\nimport { attemptModification } from './modifyConfigAsync';\nimport {\n  getBundleIdWarningAsync,\n  getPackageNameWarningAsync,\n  validateBundleId,\n  validatePackage,\n} from './validateApplicationId';\n\nconst noBundleIdMessage = `Your project must have a \\`bundleIdentifier\\` set in the Expo config (app.json or app.config.js).\\nSee https://expo.fyi/bundle-identifier`;\nconst noPackageMessage = `Your project must have a \\`package\\` set in the Expo config (app.json or app.config.js).\\nSee https://expo.fyi/android-package`;\n\nexport async function getOrPromptForBundleIdentifier(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n\n  const currentBundleId = exp.ios?.bundleIdentifier;\n  if (currentBundleId) {\n    if (validateBundleId(currentBundleId)) {\n      return currentBundleId;\n    }\n    throw new CommandError(\n      `The ios.bundleIdentifier defined in your Expo config is not formatted properly. Only alphanumeric characters, '.', '-', and '_' are allowed, and each '.' must be followed by a letter.`\n    );\n  }\n\n  // Recommend a bundle ID based on the username and project slug.\n  let recommendedBundleId: string | undefined;\n  // Attempt to use the android package name first since it's convenient to have them aligned.\n  if (exp.android?.package && validateBundleId(exp.android?.package)) {\n    recommendedBundleId = exp.android?.package;\n  } else {\n    const username = exp.owner ?? (await UserManager.getCurrentUsernameAsync());\n    const possibleId = `com.${username}.${exp.slug}`;\n    if (username && validateBundleId(possibleId)) {\n      recommendedBundleId = possibleId;\n    }\n  }\n\n  Log.addNewLineIfNone();\n  Log.log(\n    `${chalk.bold(`üìù  iOS Bundle Identifier`)} ${chalk.dim(\n      learnMore('https://expo.fyi/bundle-identifier')\n    )}`\n  );\n  Log.newLine();\n  // Prompt the user for the bundle ID.\n  // Even if the project is using a dynamic config we can still\n  // prompt a better error message, recommend a default value, and help the user\n  // validate their custom bundle ID upfront.\n  const { bundleIdentifier } = await prompt(\n    {\n      type: 'text',\n      name: 'bundleIdentifier',\n      initial: recommendedBundleId,\n      // The Apple helps people know this isn't an EAS feature.\n      message: `What would you like your iOS bundle identifier to be?`,\n      validate: validateBundleId,\n    },\n    {\n      nonInteractiveHelp: noBundleIdMessage,\n    }\n  );\n\n  // Warn the user if the bundle ID is already in use.\n  const warning = await getBundleIdWarningAsync(bundleIdentifier);\n  if (warning) {\n    Log.newLine();\n    Log.nestedWarn(warning);\n    Log.newLine();\n    if (\n      !(await confirmAsync({\n        message: `Continue?`,\n        initial: true,\n      }))\n    ) {\n      Log.newLine();\n      return getOrPromptForBundleIdentifier(projectRoot);\n    }\n  }\n\n  // Apply the changes to the config.\n  await attemptModification(\n    projectRoot,\n    {\n      ios: { ...(exp.ios || {}), bundleIdentifier },\n    },\n    { ios: { bundleIdentifier } }\n  );\n\n  return bundleIdentifier;\n}\n\nexport async function getOrPromptForPackage(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n\n  const currentPackage = exp.android?.package;\n  if (currentPackage) {\n    if (validatePackage(currentPackage)) {\n      return currentPackage;\n    }\n    throw new CommandError(\n      `Invalid format of Android package name. Only alphanumeric characters, '.' and '_' are allowed, and each '.' must be followed by a letter.`\n    );\n  }\n\n  // Recommend a package name based on the username and project slug.\n  let recommendedPackage: string | undefined;\n  // Attempt to use the ios bundle id first since it's convenient to have them aligned.\n  if (exp.ios?.bundleIdentifier && validatePackage(exp.ios.bundleIdentifier)) {\n    recommendedPackage = exp.ios.bundleIdentifier;\n  } else {\n    const username = exp.owner ?? (await UserManager.getCurrentUsernameAsync());\n    // It's common to use dashes in your node project name, strip them from the suggested package name.\n    const possibleId = `com.${username}.${exp.slug}`.split('-').join('');\n    if (username && validatePackage(possibleId)) {\n      recommendedPackage = possibleId;\n    }\n  }\n\n  Log.addNewLineIfNone();\n  Log.log(\n    `${chalk.bold(`üìù  Android package`)} ${chalk.dim(\n      learnMore('https://expo.fyi/android-package')\n    )}`\n  );\n  Log.newLine();\n\n  // Prompt the user for the android package.\n  // Even if the project is using a dynamic config we can still\n  // prompt a better error message, recommend a default value, and help the user\n  // validate their custom android package upfront.\n  const { packageName } = await prompt(\n    {\n      type: 'text',\n      name: 'packageName',\n      initial: recommendedPackage,\n      message: `What would you like your Android package name to be?`,\n      validate: validatePackage,\n    },\n    {\n      nonInteractiveHelp: noPackageMessage,\n    }\n  );\n\n  // Warn the user if the package name is already in use.\n  const warning = await getPackageNameWarningAsync(packageName);\n  if (warning) {\n    Log.newLine();\n    Log.nestedWarn(warning);\n    Log.newLine();\n    if (\n      !(await confirmAsync({\n        message: `Continue?`,\n        initial: true,\n      }))\n    ) {\n      Log.newLine();\n      return getOrPromptForPackage(projectRoot);\n    }\n  }\n\n  // Apply the changes to the config.\n  await attemptModification(\n    projectRoot,\n    {\n      android: { ...(exp.android || {}), package: packageName },\n    },\n    {\n      android: { package: packageName },\n    }\n  );\n\n  return packageName;\n}\n"],"mappings":"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"}