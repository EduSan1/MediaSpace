{"version":3,"file":"publishHistoryAsync.js","names":["HORIZ_CELL_WIDTH_SMALL","HORIZ_CELL_WIDTH_MEDIUM","HORIZ_CELL_WIDTH_BIG","actionAsync","projectRoot","options","result","getPublishHistoryAsync","raw","Log","log","JSON","stringify","queryResult","length","sampleItem","generalTableString","table","printTableJson","fullName","hasRuntimeVersion","some","publication","runtimeVersion","hasSdkVersion","sdkVersion","headers","colWidths","bigCells","Set","mediumCells","forEach","header","has","push","resultRows","map","publishedTime","dateFormat","tableString","printTableJsonArray","Error"],"sources":["../../../src/commands/publish/publishHistoryAsync.ts"],"sourcesContent":["import dateFormat from 'dateformat';\n\nimport Log from '../../log';\nimport { getPublishHistoryAsync, HistoryOptions, Publication } from '../utils/PublishUtils';\nimport * as table from '../utils/cli-table';\n\nconst HORIZ_CELL_WIDTH_SMALL = 15;\nconst HORIZ_CELL_WIDTH_MEDIUM = 20;\nconst HORIZ_CELL_WIDTH_BIG = 40;\n\nexport async function actionAsync(projectRoot: string, options: HistoryOptions) {\n  const result = await getPublishHistoryAsync(projectRoot, options);\n\n  if (options.raw) {\n    Log.log(JSON.stringify(result));\n    return;\n  }\n\n  if (result.queryResult && result.queryResult.length > 0) {\n    // Print general publication info\n    const sampleItem = result.queryResult[0]; // get a sample item\n    const generalTableString = table.printTableJson(\n      {\n        fullName: sampleItem.fullName,\n      },\n      'General Info'\n    );\n    Log.log(generalTableString);\n\n    const hasRuntimeVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.runtimeVersion\n    );\n    const hasSdkVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.sdkVersion\n    );\n\n    // Print info specific to each publication\n    const headers = [\n      'publishedTime',\n      'appVersion',\n      ...(hasSdkVersion ? ['sdkVersion'] : []),\n      ...(hasRuntimeVersion ? ['runtimeVersion'] : []),\n      'platform',\n      'channel',\n      'publicationId',\n    ];\n\n    // colWidths contains the cell size of each header\n    const colWidths: number[] = [];\n    const bigCells = new Set(['publicationId', 'publishedTime', 'channel']);\n    const mediumCells = new Set(['runtimeVersion']);\n    headers.forEach(header => {\n      if (bigCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_BIG);\n      } else if (mediumCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_MEDIUM);\n      } else {\n        colWidths.push(HORIZ_CELL_WIDTH_SMALL);\n      }\n    });\n    const resultRows: Publication[] = result.queryResult.map((publication: Publication) => ({\n      ...publication,\n      publishedTime: dateFormat(publication.publishedTime, 'ddd mmm dd yyyy HH:MM:ss Z'),\n    }));\n    const tableString = table.printTableJsonArray(headers, resultRows, colWidths);\n    Log.log(tableString);\n  } else {\n    throw new Error('No records found matching your query.');\n  }\n}\n"],"mappings":"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"}