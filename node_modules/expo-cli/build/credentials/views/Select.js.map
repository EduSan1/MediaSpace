{"version":3,"file":"Select.js","names":["SelectPlatform","open","ctx","platform","prompts","type","name","message","choices","map","value","title","optionsPerPage","view","SelectIosExperience","SelectAndroidExperience","CredentialsManager","get","changeMainView","accountName","hasProjectContext","manifest","owner","undefined","user","username","iosCredentials","ios","getAllCredentials","displayIosCredentials","projectSpecificActions","action","handleAction","getAppLookupParamsFromContext","projectName","slug","projectOwner","bundleIdentifier","Error","iosPushView","CreateAndAssignIosPush","UpdateIosPush","RemoveIosPush","iosDistView","CreateIosDist","UpdateIosDist","RemoveIosDist","app","UseExistingPushNotification","UseExistingDistributionCert","iosProvisionigProfileView","RemoveProvisioningProfile","askAboutProjectMode","experienceName","runProjectContext","confirmAsync","assert","androidView","ExperienceView","credentials","android","fetchAll","displayAndroidCredentials","Object","values","cred","QuitError","constructor","setPrototypeOf","prototype","DoQuit","runAsync","mainpage","AskQuit","selected","process","exit"],"sources":["../../../src/credentials/views/Select.ts"],"sourcesContent":["import assert from 'assert';\n\nimport prompts, { confirmAsync } from '../../utils/prompts';\nimport { displayAndroidCredentials, displayIosCredentials } from '../actions/list';\nimport { AppLookupParams } from '../api/IosApi';\nimport { Context, IView } from '../context';\nimport { CredentialsManager } from '../route';\nimport * as androidView from './AndroidCredentials';\nimport * as iosDistView from './IosDistCert';\nimport * as iosProvisionigProfileView from './IosProvisioningProfile';\nimport * as iosPushView from './IosPushCredentials';\n\nexport class SelectPlatform implements IView {\n  async open(ctx: Context): Promise<IView | null> {\n    const { platform } = await prompts({\n      type: 'select',\n      name: 'platform',\n      message: 'Select platform',\n      choices: ['ios', 'android'].map(value => ({ value, title: value })),\n      optionsPerPage: 20,\n    });\n    const view = platform === 'ios' ? new SelectIosExperience() : new SelectAndroidExperience();\n    CredentialsManager.get().changeMainView(view);\n    return view;\n  }\n}\n\nexport class SelectIosExperience implements IView {\n  async open(ctx: Context): Promise<IView | null> {\n    const accountName =\n      (ctx.hasProjectContext ? ctx.manifest.owner : undefined) ?? ctx.user.username;\n    const iosCredentials = await ctx.ios.getAllCredentials(accountName);\n\n    await displayIosCredentials(iosCredentials);\n\n    const projectSpecificActions: { value: string; title: string }[] = ctx.hasProjectContext\n      ? [\n          {\n            value: 'use-existing-push-ios',\n            title: 'Use existing Push Notifications Key in current project',\n          },\n          {\n            value: 'use-existing-dist-ios',\n            title: 'Use existing Distribution Certificate in current project',\n          },\n          // {\n          //   value: 'current-remove-push-ios',\n          //   name: 'Remove Push Notifactions credentials for current project',\n          // },\n          // {\n          //   value: 'current-remove-dist-ios',\n          //   name: 'Remove Distribution Certificate for current project',\n          // },\n          // {\n          //   value: 'current-remove-app-ios',\n          //   name: 'Remove all credentials for current project',\n          // },\n        ]\n      : [];\n\n    const { action } = await prompts({\n      type: 'select',\n      name: 'action',\n      message: 'What do you want to do?',\n      choices: [\n        ...projectSpecificActions,\n        { value: 'remove-provisioning-profile', title: 'Remove Provisioning Profile' },\n        { value: 'create-ios-push', title: 'Add new Push Notifications Key' },\n        { value: 'remove-ios-push', title: 'Remove Push Notification credentials' },\n        { value: 'update-ios-push', title: 'Update Push Notifications Key' },\n        { value: 'create-ios-dist', title: 'Add new Distribution Certificate' },\n        { value: 'remove-ios-dist', title: 'Remove Distribution Certificate' },\n        { value: 'update-ios-dist', title: 'Update Distribution Certificate' },\n      ],\n      optionsPerPage: 20,\n    });\n    return this.handleAction(ctx, accountName, action);\n  }\n\n  getAppLookupParamsFromContext(ctx: Context): AppLookupParams {\n    const projectName = ctx.manifest.slug;\n    const accountName = ctx.projectOwner;\n    const bundleIdentifier = ctx.manifest.ios?.bundleIdentifier;\n    if (!bundleIdentifier) {\n      throw new Error(`ios.bundleIdentifier need to be defined`);\n    }\n\n    return { accountName, projectName, bundleIdentifier };\n  }\n\n  handleAction(ctx: Context, accountName: string, action: string): IView | null {\n    switch (action) {\n      case 'create-ios-push':\n        return new iosPushView.CreateAndAssignIosPush(accountName);\n      case 'update-ios-push':\n        return new iosPushView.UpdateIosPush(accountName);\n      case 'remove-ios-push':\n        return new iosPushView.RemoveIosPush(accountName);\n      case 'create-ios-dist':\n        return new iosDistView.CreateIosDist(accountName);\n      case 'update-ios-dist':\n        return new iosDistView.UpdateIosDist(accountName);\n      case 'remove-ios-dist':\n        return new iosDistView.RemoveIosDist(accountName);\n      case 'use-existing-push-ios': {\n        const app = this.getAppLookupParamsFromContext(ctx);\n        return new iosPushView.UseExistingPushNotification(app);\n      }\n      case 'use-existing-dist-ios': {\n        const app = this.getAppLookupParamsFromContext(ctx);\n        return new iosDistView.UseExistingDistributionCert(app);\n      }\n      case 'remove-provisioning-profile':\n        return new iosProvisionigProfileView.RemoveProvisioningProfile(accountName);\n      default:\n        throw new Error('Unknown action selected');\n    }\n  }\n}\n\nexport class SelectAndroidExperience implements IView {\n  private askAboutProjectMode = true;\n\n  async open(ctx: Context): Promise<IView | null> {\n    if (ctx.hasProjectContext && this.askAboutProjectMode) {\n      const experienceName = `@${ctx.projectOwner}/${ctx.manifest.slug}`;\n\n      const runProjectContext = await confirmAsync({\n        message: `You are currently in a directory with ${experienceName} experience. Do you want to select it?`,\n      });\n\n      if (runProjectContext) {\n        assert(ctx.manifest.slug, 'app.json slug field must be set');\n        const view = new androidView.ExperienceView(experienceName);\n        CredentialsManager.get().changeMainView(view);\n        return view;\n      }\n    }\n    this.askAboutProjectMode = false;\n\n    const credentials = await ctx.android.fetchAll();\n    await displayAndroidCredentials(Object.values(credentials));\n\n    const { experienceName } = await prompts({\n      type: 'select',\n      name: 'experienceName',\n      message: 'Select application',\n      choices: Object.values(credentials).map(cred => ({\n        title: cred.experienceName,\n        value: cred.experienceName,\n      })),\n      optionsPerPage: 20,\n    });\n\n    return new androidView.ExperienceView(experienceName);\n  }\n}\n\nexport class QuitError extends Error {\n  constructor() {\n    super();\n\n    // Set the prototype explicitly.\n    // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n    Object.setPrototypeOf(this, QuitError.prototype);\n  }\n}\n\nexport interface IQuit {\n  runAsync(mainpage: IView): Promise<IView>;\n}\n\nexport class DoQuit implements IQuit {\n  async runAsync(mainpage: IView): Promise<IView> {\n    throw new QuitError();\n  }\n}\n\nexport class AskQuit implements IQuit {\n  async runAsync(mainpage: IView): Promise<IView> {\n    const { selected } = await prompts({\n      type: 'select',\n      name: 'selected',\n      message: 'Do you want to quit Credential Manager',\n      choices: [\n        { value: 'exit', title: 'Quit Credential Manager' },\n        { value: 'mainpage', title: 'Go back to experience overview.' },\n      ],\n    });\n    if (selected === 'exit') {\n      process.exit(0);\n    }\n    return mainpage;\n  }\n}\n"],"mappings":"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"}