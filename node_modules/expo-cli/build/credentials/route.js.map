{"version":3,"file":"route.js","names":["runCredentialsManagerStandalone","ctx","startView","manager","CredentialsManager","AskQuit","run","runCredentialsManager","DoQuit","constructor","quit","_manager","_ctx","_mainView","_currentView","_quit","get","Error","open","runAsync","error","QuitError","Log","log","sleep","changeMainView","view"],"sources":["../../src/credentials/route.ts"],"sourcesContent":["import { sleep } from '../commands/utils/promise';\nimport Log from '../log';\nimport { Context, IView } from './context';\nimport { AskQuit, DoQuit, IQuit, QuitError } from './views/Select';\n\nexport async function runCredentialsManagerStandalone(ctx: Context, startView: IView) {\n  const manager = new CredentialsManager(ctx, startView, new AskQuit());\n  await manager.run();\n}\n\nexport async function runCredentialsManager(ctx: Context, startView: IView): Promise<null> {\n  const manager = new CredentialsManager(ctx, startView, new DoQuit());\n  return await manager.run();\n}\n\nexport class CredentialsManager {\n  static _manager?: CredentialsManager;\n  _ctx: Context;\n  _mainView: IView;\n  _currentView: IView;\n  _quit: IQuit;\n\n  constructor(ctx: Context, startView: IView, quit: IQuit) {\n    CredentialsManager._manager = this;\n    this._ctx = ctx;\n    this._mainView = startView;\n    this._currentView = startView;\n    this._quit = quit;\n  }\n\n  static get(): CredentialsManager {\n    if (!CredentialsManager._manager) {\n      throw new Error('Credential Manager has not been initialized yet');\n    }\n    return CredentialsManager._manager;\n  }\n\n  async run(): Promise<null> {\n    while (true) {\n      try {\n        this._currentView =\n          (await this._currentView.open(this._ctx)) || (await this._quit.runAsync(this._mainView));\n      } catch (error: any) {\n        // View quit normally, exit normally\n        if (error instanceof QuitError) {\n          return null;\n        }\n\n        // View encountered error\n        if (this._quit instanceof DoQuit) {\n          // propagate error up\n          throw error;\n        } else {\n          // fallback to interactive Quit View\n          Log.log(error);\n          await sleep(1000);\n          this._currentView = await this._quit.runAsync(this._mainView);\n        }\n      }\n    }\n  }\n\n  changeMainView(view: IView) {\n    this._mainView = view;\n  }\n}\n"],"mappings":";;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;;;AAEO,eAAeA,+BAAf,CAA+CC,GAA/C,EAA6DC,SAA7D,EAA+E;EACpF,MAAMC,OAAO,GAAG,IAAIC,kBAAJ,CAAuBH,GAAvB,EAA4BC,SAA5B,EAAuC,KAAIG,iBAAJ,GAAvC,CAAhB;EACA,MAAMF,OAAO,CAACG,GAAR,EAAN;AACD;;AAEM,eAAeC,qBAAf,CAAqCN,GAArC,EAAmDC,SAAnD,EAAoF;EACzF,MAAMC,OAAO,GAAG,IAAIC,kBAAJ,CAAuBH,GAAvB,EAA4BC,SAA5B,EAAuC,KAAIM,gBAAJ,GAAvC,CAAhB;EACA,OAAO,MAAML,OAAO,CAACG,GAAR,EAAb;AACD;;AAEM,MAAMF,kBAAN,CAAyB;EAO9BK,WAAW,CAACR,GAAD,EAAeC,SAAf,EAAiCQ,IAAjC,EAA8C;IAAA;;IAAA;;IAAA;;IAAA;;IACvDN,kBAAkB,CAACO,QAAnB,GAA8B,IAA9B;IACA,KAAKC,IAAL,GAAYX,GAAZ;IACA,KAAKY,SAAL,GAAiBX,SAAjB;IACA,KAAKY,YAAL,GAAoBZ,SAApB;IACA,KAAKa,KAAL,GAAaL,IAAb;EACD;;EAES,OAAHM,GAAG,GAAuB;IAC/B,IAAI,CAACZ,kBAAkB,CAACO,QAAxB,EAAkC;MAChC,MAAM,IAAIM,KAAJ,CAAU,iDAAV,CAAN;IACD;;IACD,OAAOb,kBAAkB,CAACO,QAA1B;EACD;;EAEQ,MAAHL,GAAG,GAAkB;IACzB,OAAO,IAAP,EAAa;MACX,IAAI;QACF,KAAKQ,YAAL,GACE,CAAC,MAAM,KAAKA,YAAL,CAAkBI,IAAlB,CAAuB,KAAKN,IAA5B,CAAP,MAA8C,MAAM,KAAKG,KAAL,CAAWI,QAAX,CAAoB,KAAKN,SAAzB,CAApD,CADF;MAED,CAHD,CAGE,OAAOO,KAAP,EAAmB;QACnB;QACA,IAAIA,KAAK,YAAYC,mBAArB,EAAgC;UAC9B,OAAO,IAAP;QACD,CAJkB,CAMnB;;;QACA,IAAI,KAAKN,KAAL,YAAsBP,gBAA1B,EAAkC;UAChC;UACA,MAAMY,KAAN;QACD,CAHD,MAGO;UACL;UACAE,cAAA,CAAIC,GAAJ,CAAQH,KAAR;;UACA,MAAM,IAAAI,gBAAA,EAAM,IAAN,CAAN;UACA,KAAKV,YAAL,GAAoB,MAAM,KAAKC,KAAL,CAAWI,QAAX,CAAoB,KAAKN,SAAzB,CAA1B;QACD;MACF;IACF;EACF;;EAEDY,cAAc,CAACC,IAAD,EAAc;IAC1B,KAAKb,SAAL,GAAiBa,IAAjB;EACD;;AAjD6B;;;;gBAAnBtB,kB"}