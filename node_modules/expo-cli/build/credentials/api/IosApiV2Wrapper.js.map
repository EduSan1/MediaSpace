{"version":3,"file":"IosApiV2Wrapper.js","names":["ApiClient","constructor","api","getAllCredentialsApi","accountName","getAsync","owner","getAllCredentialsForAppApi","projectName","bundleIdentifier","getUserCredentialsByIdApi","id","createDistCertApi","credentials","postAsync","updateDistCertApi","putAsync","deleteDistCertApi","deleteAsync","useDistCertApi","userCredentialsId","experienceName","createPushKeyApi","updatePushKeyApi","deletePushKeyApi","usePushKeyApi","deletePushCertApi","updateProvisioningProfileApi","deleteProvisioningProfileApi"],"sources":["../../../src/credentials/api/IosApiV2Wrapper.ts"],"sourcesContent":["import { ApiV2 } from 'xdl';\n\nimport * as appleApi from '../../appleApi';\nimport { IosAppCredentials, IosDistCredentials, IosPushCredentials } from '../credentials';\n\nexport interface AppLookupParams {\n  accountName: string;\n  projectName: string;\n  bundleIdentifier: string;\n}\n\ninterface IosAllCredentialsForApp extends IosAppCredentials {\n  pushCredentials: Omit<IosPushCredentials, 'id' | 'type'>;\n  distCredentials: Omit<IosDistCredentials, 'id' | 'type'>;\n}\n\ninterface AllCredentialsApiResponse {\n  appCredentials: IosAppCredentials[];\n  userCredentials: (IosDistCredentials | IosPushCredentials)[];\n}\n\n// This class should not be used directly, use only as part of cached api client from ./IosApi.ts\n// or mock it in tests (it's easier to mock this class than ApiV2 directly)\nexport default class ApiClient {\n  constructor(private api: ApiV2) {}\n\n  public async getAllCredentialsApi(accountName: string): Promise<AllCredentialsApiResponse> {\n    return await this.api.getAsync('credentials/ios', { owner: accountName });\n  }\n  public async getAllCredentialsForAppApi({\n    accountName,\n    projectName,\n    bundleIdentifier,\n  }: AppLookupParams): Promise<IosAllCredentialsForApp> {\n    return await this.api.getAsync(\n      `credentials/ios/@${accountName}/${projectName}/${bundleIdentifier}`\n    );\n  }\n\n  public async getUserCredentialsByIdApi(\n    id: number,\n    accountName: string\n  ): Promise<IosDistCredentials | IosPushCredentials> {\n    return await this.api.getAsync(`credentials/ios/userCredentials/${id}`, { owner: accountName });\n  }\n\n  public async createDistCertApi(\n    accountName: string,\n    credentials: appleApi.DistCert\n  ): Promise<number> {\n    const { id } = await this.api.postAsync('credentials/ios/dist', {\n      owner: accountName,\n      credentials,\n    });\n    return id;\n  }\n\n  public async updateDistCertApi(\n    id: number,\n    accountName: string,\n    credentials: appleApi.DistCert\n  ): Promise<void> {\n    await this.api.putAsync(`credentials/ios/dist/${id}`, { credentials, owner: accountName });\n  }\n\n  public async deleteDistCertApi(id: number, accountName: string): Promise<void> {\n    await this.api.deleteAsync(`credentials/ios/dist/${id}`, { owner: accountName });\n  }\n\n  public async useDistCertApi(\n    { accountName, projectName, bundleIdentifier }: AppLookupParams,\n    userCredentialsId: number\n  ): Promise<void> {\n    await this.api.postAsync('credentials/ios/use/dist', {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n      userCredentialsId,\n    });\n  }\n\n  public async createPushKeyApi(\n    accountName: string,\n    credentials: appleApi.PushKey\n  ): Promise<number> {\n    const { id } = await this.api.postAsync('credentials/ios/push', {\n      owner: accountName,\n      credentials,\n    });\n    return id;\n  }\n\n  public async updatePushKeyApi(\n    id: number,\n    accountName: string,\n    credentials: appleApi.PushKey\n  ): Promise<IosPushCredentials> {\n    return await this.api.putAsync(`credentials/ios/push/${id}`, { owner: accountName });\n  }\n\n  public async deletePushKeyApi(id: number, accountName: string): Promise<void> {\n    await this.api.deleteAsync(`credentials/ios/push/${id}`, { owner: accountName });\n  }\n\n  public async usePushKeyApi(\n    { accountName, projectName, bundleIdentifier }: AppLookupParams,\n    userCredentialsId: number\n  ): Promise<void> {\n    await this.api.postAsync('credentials/ios/use/push', {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n      userCredentialsId,\n    });\n  }\n\n  public async deletePushCertApi({\n    accountName,\n    projectName,\n    bundleIdentifier,\n  }: AppLookupParams): Promise<void> {\n    await this.api.postAsync(`credentials/ios/pushCert/delete`, {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n    });\n  }\n\n  public async updateProvisioningProfileApi(\n    { accountName, projectName, bundleIdentifier }: AppLookupParams,\n    credentials: appleApi.ProvisioningProfile\n  ): Promise<void> {\n    await this.api.postAsync(`credentials/ios/provisioningProfile/update`, {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n      credentials,\n    });\n  }\n\n  public async deleteProvisioningProfileApi({\n    accountName,\n    projectName,\n    bundleIdentifier,\n  }: AppLookupParams): Promise<void> {\n    await this.api.postAsync(`credentials/ios/provisioningProfile/delete`, {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n    });\n  }\n}\n"],"mappings":"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"}