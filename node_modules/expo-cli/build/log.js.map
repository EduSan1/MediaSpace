{"version":3,"file":"log.js","names":["isProfiling","boolish","consoleTime","console","time","consoleTimeEnd","timeEnd","Log","log","args","respectProgressBars","consoleLog","withPrefix","nested","message","newLine","addNewLineIfNone","_isLastLineNewLine","_printNewLineBeforeNextLog","printNewLineBeforeNextLog","setBundleProgressBar","bar","_bundleProgressBar","setSpinner","oraSpinner","_oraSpinner","__modified","originalStart","start","bind","text","originalStop","stop","getSpinner","getProgress","error","consoleError","withPrefixAndTextColor","chalk","red","nestedError","warn","consoleWarn","yellow","debug","isDebug","consoleDebug","info","consoleInfo","nestedWarn","gray","clear","process","stdout","write","platform","_updateIsLastLineNewLine","length","lastArg","match","_maybePrintNewLine","commitLogs","progressBar","complete","stream","clearLine","cursorTo","spinner","isSpinning","frameIndex","render","getPrefix","chalkColor","Date","toTimeString","slice","program","nonInteractive","map","arg","terminalLink"],"sources":["../src/log.ts"],"sourcesContent":["import chalk from 'chalk';\nimport program from 'commander';\nimport { boolish } from 'getenv';\nimport type { Ora } from 'ora';\nimport type ProgressBar from 'progress';\nimport terminalLink from 'terminal-link';\n\ntype Color = (...text: string[]) => string;\n\nconst isProfiling = boolish('EXPO_PROFILE', false);\n\n// eslint-disable-next-line no-console\nconst consoleTime: (label?: string) => void = isProfiling ? console.time : () => {};\n// eslint-disable-next-line no-console\nconst consoleTimeEnd: (label?: string) => void = isProfiling ? console.timeEnd : () => {};\n\nexport default class Log {\n  public static readonly chalk = chalk;\n  public static readonly terminalLink = terminalLink;\n  public static readonly isDebug = boolish('EXPO_DEBUG', false);\n  public static readonly isProfiling = isProfiling;\n\n  public static log(...args: any[]) {\n    Log.respectProgressBars(() => {\n      Log.consoleLog(...Log.withPrefix(args));\n    });\n  }\n\n  public static nested(message: any) {\n    Log.respectProgressBars(() => {\n      Log.consoleLog(message);\n    });\n  }\n\n  public static time = consoleTime;\n\n  public static timeEnd = consoleTimeEnd;\n\n  public static newLine() {\n    Log.respectProgressBars(() => {\n      Log.consoleLog();\n    });\n  }\n\n  public static addNewLineIfNone() {\n    if (!Log._isLastLineNewLine && !Log._printNewLineBeforeNextLog) {\n      Log.newLine();\n    }\n  }\n\n  public static printNewLineBeforeNextLog() {\n    Log._printNewLineBeforeNextLog = true;\n  }\n\n  public static setBundleProgressBar(bar: ProgressBar | null) {\n    Log._bundleProgressBar = bar;\n  }\n\n  public static setSpinner(oraSpinner: (Ora & { __modified?: boolean }) | null) {\n    Log._oraSpinner = oraSpinner;\n    if (oraSpinner && !oraSpinner.__modified) {\n      oraSpinner.__modified = true;\n      const originalStart = oraSpinner.start.bind(oraSpinner);\n      oraSpinner.start = function (text: any) {\n        // Reset the new line tracker\n        Log._isLastLineNewLine = false;\n        // Ensure we set the observable spinner to this because it is animating.\n        Log.setSpinner(this);\n        return originalStart(text);\n      };\n      // All other methods of stopping will invoke the stop method.\n      const originalStop = oraSpinner.stop.bind(oraSpinner);\n      oraSpinner.stop = () => {\n        // Reset the target spinner\n        Log.setSpinner(null);\n        return originalStop();\n      };\n    }\n  }\n\n  public static getSpinner() {\n    return Log._oraSpinner || null;\n  }\n\n  public static getProgress() {\n    return Log._bundleProgressBar || null;\n  }\n\n  public static error(...args: any[]) {\n    Log.respectProgressBars(() => {\n      Log.consoleError(...Log.withPrefixAndTextColor(args, chalk.red));\n    });\n  }\n\n  public static nestedError(message: string) {\n    Log.respectProgressBars(() => {\n      Log.consoleError(chalk.red(message));\n    });\n  }\n\n  public static warn(...args: any[]) {\n    Log.respectProgressBars(() => {\n      Log.consoleWarn(...Log.withPrefixAndTextColor(args, chalk.yellow));\n    });\n  }\n\n  // Only show these logs when EXPO_DEBUG is active\n  public static debug(...args: any[]) {\n    if (!Log.isDebug) {\n      return;\n    }\n    Log.respectProgressBars(() => {\n      Log.consoleDebug(...Log.withPrefixAndTextColor(args));\n    });\n  }\n\n  public static info(...args: any[]) {\n    Log.respectProgressBars(() => {\n      Log.consoleInfo(...args);\n    });\n  }\n\n  public static nestedWarn(message: string) {\n    Log.respectProgressBars(() => {\n      Log.consoleWarn(chalk.yellow(message));\n    });\n  }\n\n  public static gray(...args: any[]) {\n    Log.respectProgressBars(() => {\n      Log.consoleLog(...Log.withPrefixAndTextColor(args));\n    });\n  }\n\n  public static clear() {\n    process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n  }\n\n  private static _bundleProgressBar: ProgressBar | null;\n  private static _oraSpinner: Ora | null;\n\n  private static _printNewLineBeforeNextLog = false;\n  private static _isLastLineNewLine = false;\n  private static _updateIsLastLineNewLine(args: any[]) {\n    if (args.length === 0) {\n      Log._isLastLineNewLine = true;\n    } else {\n      const lastArg = args[args.length - 1];\n      if (typeof lastArg === 'string' && (lastArg === '' || lastArg.match(/[\\r\\n]$/))) {\n        Log._isLastLineNewLine = true;\n      } else {\n        Log._isLastLineNewLine = false;\n      }\n    }\n  }\n\n  private static _maybePrintNewLine() {\n    if (Log._printNewLineBeforeNextLog) {\n      Log._printNewLineBeforeNextLog = false;\n      console.log(); // eslint-disable-line no-console\n    }\n  }\n\n  private static consoleDebug(...args: any[]) {\n    Log._maybePrintNewLine();\n    Log._updateIsLastLineNewLine(args);\n\n    console.debug(...args); // eslint-disable-line no-console\n  }\n\n  private static consoleInfo(...args: any[]) {\n    Log._maybePrintNewLine();\n    Log._updateIsLastLineNewLine(args);\n\n    console.info(...args); // eslint-disable-line no-console\n  }\n\n  private static consoleLog(...args: any[]) {\n    Log._maybePrintNewLine();\n    Log._updateIsLastLineNewLine(args);\n\n    console.log(...args); // eslint-disable-line no-console\n  }\n\n  private static consoleWarn(...args: any[]) {\n    Log._maybePrintNewLine();\n    Log._updateIsLastLineNewLine(args);\n\n    console.warn(...args); // eslint-disable-line no-console\n  }\n\n  private static consoleError(...args: any[]) {\n    Log._maybePrintNewLine();\n    Log._updateIsLastLineNewLine(args);\n\n    console.error(...args); // eslint-disable-line no-console\n  }\n\n  private static respectProgressBars(commitLogs: () => void) {\n    let progressBar = Log._bundleProgressBar;\n\n    if (progressBar) {\n      // Automatically unmount the bar if it's complete\n      if (progressBar.complete) {\n        Log.setBundleProgressBar(null);\n        progressBar = null;\n      } else if ('stream' in progressBar) {\n        // @ts-ignore\n        progressBar.stream?.clearLine?.();\n        // @ts-ignore\n        progressBar.stream?.cursorTo?.(0);\n      }\n    }\n\n    const spinner = Log._oraSpinner;\n    const isSpinning = spinner?.isSpinning;\n    // Store the index, before stopping for later.\n    const frameIndex: number = (spinner as any)?.frameIndex || 0;\n    if (spinner && isSpinning) {\n      spinner.stop();\n    }\n    commitLogs();\n\n    if (progressBar) {\n      progressBar.render();\n    }\n    // Only restart the spinner if it was spinning to begin with, this\n    // prevents us from accidentally starting a paused spinner.\n    if (spinner && isSpinning) {\n      // Stopping the spinner causes the frameIndex to be set to 0, we want to set it to what it was before we reset it so it continues to animate as expected.\n      // @ts-ignore\n      spinner.frameIndex = frameIndex;\n      spinner.start();\n      spinner.render();\n    }\n  }\n\n  private static getPrefix(chalkColor: Color) {\n    return chalkColor(`[${new Date().toTimeString().slice(0, 8)}]`);\n  }\n\n  private static withPrefixAndTextColor(args: any[], chalkColor: Color = chalk.gray) {\n    if (program.nonInteractive) {\n      return [Log.getPrefix(chalkColor), ...args.map(arg => chalkColor(arg))];\n    } else {\n      return args.map(arg => chalkColor(arg));\n    }\n  }\n\n  private static withPrefix(args: any[], chalkColor = chalk.gray) {\n    if (program.nonInteractive) {\n      return [Log.getPrefix(chalkColor), ...args];\n    } else {\n      return args;\n    }\n  }\n}\n"],"mappings":"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"}