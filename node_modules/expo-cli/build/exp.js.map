{"version":3,"file":"exp.js","names":["packageJSON","require","ApiV2","setClientName","version","Command","prototype","urlOpts","addOptions","allowOffline","option","helpGroup","name","commands","length","__helpGroup","parent","longDescription","__longDescription","pad","str","width","len","Math","max","stripAnsi","Array","join","humanReadableArgName","arg","nameOutput","variadic","required","breakSentence","input","wrapAnsi","prepareCommands","filter","cmd","getenv","boolish","includes","map","i","args","_args","description","_description","nameWithAlias","_name","usage","commandsStr","argsStr","arguments","_usage","helpInformation","desc","replaceAll","argsDescription","_argsDescription","padWidth","push","forEach","cmdName","_alias","chalk","bold","dim","commandHelp","options","optionHelp","replace","string","search","split","helpGroupOrder","sortHelpGroups","helpGroups","groupOrder","Set","Object","keys","subGroupOrder","core","sortSubGroupWithOrder","groupName","group","order","sortedCommands","key","shift","index","findIndex","item","startsWith","splice","concat","sortedGroups","reduce","prev","curr","command","sorted","values","noArgsCmd","noArgsCmdArgs","wrappedDescription","paddedName","program","on","Log","log","asyncAction","asyncFn","action","nonInteractive","profileMethod","checkCliVersionAsync","offline","ConnectionStatus","setIsOffline","Promise","all","Analytics","flush","UnifiedAnalytics","err","commandName","handleErrorsAsync","process","exit","asyncActionProjectDir","yellow","projectRoot","opts","cwd","path","resolve","config","learnMore","newLine","addNewLineIfNone","green","cyan","pathToConfig","fs","existsSync","relativeInput","relative","formattedPath","reset","nestedWarn","helpCommand","setCustomConfigPath","logLines","msg","logFn","line","INTERNAL_CALLSITES_REGEX","logStackTrace","chunk","nestedLogFn","traceInfo","JSON","parse","message","stack","isLibraryFrame","stackFrames","lastAppCodeFrameIndex","findLastIndex","lastFrameIndexToLog","min","unloggedFrames","isCollapsed","fileNameOrUrl","matchFileNameOrURLFromStackTrace","test","isDebug","style","printNewLineBeforeNextLog","logWithLevel","level","bunyan","INFO","includesStack","nested","WARN","warn","error","nestedError","bar","PackagerLogsStream","onStartBuildBundle","bundleDetails","platform","getPlatformTagForBuildDetails","ProgressBar","total","clear","complete","incomplete","setBundleProgressBar","onProgressBuildBundle","progress","ticks","tick","onFinishBuildBundle","start","end","terminate","totalBuildTimeMs","getTime","durationSuffix","gray","red","StatusEventEmitter","emit","updateLogs","updater","newLogChunks","newLogChunk","issueId","issueCleared","ProjectUtils","attachLoggerStream","stream","write","tag","deviceId","deviceName","type","checkConfig","ProjectSettings","getCurrentStatusAsync","spinner","ora","setSpinner","Doctor","status","validateWithoutNetworkAsync","skipSDKVersionRequirement","FATAL","Error","stop","bootstrapAnalyticsAsync","initializeClient","userData","UserManager","getCachedUserDataAsync","userId","identifyUser","currentConnection","username","trackUsage","argv","ExpoCommand","undefined","subCommand","find","logEvent","source","source_version","runAsync","programName","_registerLogs","Env","shouldEnableAnalytics","setInteractiveAuthenticationCallback","loginOrRegisterAsync","env","SERVER_URL","serverUrl","parsedUrl","url","port","parseInt","hostname","Config","api","host","registerCommands","availableCommands","suggestion","leven","stdin","isTTY","help","e","updateIsAvailable","current","latest","deprecated","update","checkForUpdateAsync","boxen","borderColor","padding","code","LoadingEvent","START_PROGRESS_BAR","TICK_PROGRESS_BAR","getProgress","STOP_PROGRESS_BAR","START_LOADING","logNewSection","STOP_LOADING","getSpinner","DEBUG","debug","ERROR","Logger","notifications","addStream","global","writePathAsync","Binaries","writePathToUserSettingsAsync","run","catch"],"sources":["../src/exp.ts"],"sourcesContent":["import bunyan from '@expo/bunyan';\nimport { setCustomConfigPath } from '@expo/config';\nimport boxen from 'boxen';\nimport chalk from 'chalk';\nimport program, { Command } from 'commander';\nimport fs from 'fs';\nimport getenv from 'getenv';\nimport leven from 'leven';\nimport findLastIndex from 'lodash/findLastIndex';\nimport path from 'path';\nimport ProgressBar from 'progress';\nimport stripAnsi from 'strip-ansi';\nimport url from 'url';\nimport wrapAnsi from 'wrap-ansi';\nimport {\n  Analytics,\n  ApiV2,\n  Binaries,\n  Config,\n  Env,\n  LoadingEvent,\n  Logger,\n  LogRecord,\n  LogUpdater,\n  PackagerLogsStream,\n  ProjectSettings,\n  ProjectUtils,\n  UnifiedAnalytics,\n  UserManager,\n} from 'xdl';\n\nimport StatusEventEmitter from './analytics/StatusEventEmitter';\nimport { registerCommands } from './commands';\nimport { loginOrRegisterAsync } from './commands/auth/accounts';\nimport { learnMore } from './commands/utils/TerminalLink';\nimport { profileMethod } from './commands/utils/profileMethod';\nimport urlOpts from './commands/utils/urlOpts';\nimport Log from './log';\nimport { handleErrorsAsync } from './utils/handleErrors';\nimport { matchFileNameOrURLFromStackTrace } from './utils/matchFileNameOrURLFromStackTrace';\nimport { logNewSection, ora } from './utils/ora';\nimport update from './utils/update';\n\n// We use require() to exclude package.json from TypeScript's analysis since it lives outside the\n// src directory and would change the directory structure of the emitted files under the build\n// directory\nconst packageJSON = require('../package.json');\n\nApiV2.setClientName(packageJSON.version);\n\n// The following prototyped functions are not used here, but within in each file found in `./commands`\n// Extending commander to easily add more options to certain command line arguments\nCommand.prototype.urlOpts = function () {\n  urlOpts.addOptions(this);\n  return this;\n};\n\nCommand.prototype.allowOffline = function () {\n  this.option('--offline', 'Allows this command to run while offline');\n  return this;\n};\n\n// Add support for logical command groupings\nCommand.prototype.helpGroup = function (name: string) {\n  if (this.commands[this.commands.length - 1]) {\n    this.commands[this.commands.length - 1].__helpGroup = name;\n  } else {\n    this.parent.helpGroup(name);\n  }\n  return this;\n};\n\n// A longer description that will be displayed then the command is used with --help\nCommand.prototype.longDescription = function (name: string) {\n  if (this.commands[this.commands.length - 1]) {\n    this.commands[this.commands.length - 1].__longDescription = name;\n  } else {\n    this.parent.longDescription(name);\n  }\n  return this;\n};\n\nfunction pad(str: string, width: number): string {\n  // Pulled from commander for overriding\n  const len = Math.max(0, width - stripAnsi(str).length);\n  return str + Array(len + 1).join(' ');\n}\n\nfunction humanReadableArgName(arg: any): string {\n  // Pulled from commander for overriding\n  const nameOutput = arg.name + (arg.variadic === true ? '...' : '');\n  return arg.required ? `<${nameOutput}>` : `[${nameOutput}]`;\n}\n\nfunction breakSentence(input: string): string {\n  // Break a sentence by the word after a max character count, adjusting for ansi characters\n  return wrapAnsi(input, 72);\n}\n\nCommand.prototype.prepareCommands = function () {\n  return this.commands\n    .filter(function (cmd: Command) {\n      // Display all commands with EXPO_DEBUG, otherwise use the noHelp option.\n      if (getenv.boolish('EXPO_DEBUG', false)) {\n        return true;\n      }\n      return !['internal'].includes(cmd.__helpGroup);\n    })\n    .map(function (cmd: Command, i: number) {\n      const args = cmd._args.map(humanReadableArgName).join(' ');\n\n      const description = cmd._description;\n      // Remove alias. We still show this with --help on the command.\n      // const alias = cmd._alias;\n      // const nameWithAlias = cmd._name + (alias ? '|' + alias : '');\n      const nameWithAlias = cmd._name;\n      return [\n        nameWithAlias +\n          // Remove the redundant [options] string that's shown after every command.\n          // (cmd.options.length ? ' [options]' : '') +\n          (args ? ' ' + args : ''),\n        breakSentence(description),\n        cmd.__helpGroup ?? 'misc',\n      ];\n    });\n};\n\n/**\n * Set / get the command usage `str`.\n *\n * @param {String} str\n * @return {String|Command}\n * @api public\n */\n\n// @ts-ignore\nCommand.prototype.usage = function (str: string) {\n  const args = this._args.map(function (arg: any[]) {\n    return humanReadableArgName(arg);\n  });\n\n  const commandsStr = this.commands.length ? '[command]' : '';\n  const argsStr = this._args.length ? args.join(' ') : '';\n\n  let usage = commandsStr + argsStr;\n  if (usage.length) usage += ' ';\n  usage += '[options]';\n\n  if (arguments.length === 0) {\n    return this._usage || usage;\n  }\n  this._usage = str;\n\n  return this;\n};\n\nCommand.prototype.helpInformation = function () {\n  let desc: string[] = [];\n  // Use the long description if available, otherwise use the regular description.\n  const description = this.__longDescription ?? this._description;\n  if (description) {\n    desc = [replaceAll(breakSentence(description), '\\n', pad('\\n', 3)), ''];\n\n    const argsDescription = this._argsDescription;\n    if (argsDescription && this._args.length) {\n      const width = this.padWidth();\n      desc.push('Arguments:');\n      desc.push('');\n      this._args.forEach(({ name }: { name: string }) => {\n        desc.push('  ' + pad(name, width) + '  ' + argsDescription[name]);\n      });\n      desc.push('');\n    }\n  }\n\n  let cmdName = this._name;\n  if (this._alias) {\n    // Here is the only place we show the command alias\n    cmdName = `${cmdName}|${this._alias}`;\n  }\n\n  // Dim the options to keep things consistent.\n  const usage = `${chalk.bold`Usage:`} ${cmdName} ${chalk.dim(this.usage())}\\n`;\n\n  const commandHelp = '' + this.commandHelp();\n\n  const options = [chalk.bold`Options:`, '\\n' + this.optionHelp().replace(/^/gm, '    '), ''];\n\n  // return ['', usage, ...desc, ...options, commandHelp].join('\\n') + '\\n';\n  return ['', usage, ...desc, ...options, commandHelp].join(pad('\\n', 3)) + '\\n';\n};\n\nfunction replaceAll(string: string, search: string, replace: string): string {\n  return string.split(search).join(replace);\n}\n\nexport const helpGroupOrder = [\n  'core',\n  'auth',\n  'client',\n  'info',\n  'eject',\n  'publish',\n  'build',\n  'credentials',\n  'notifications',\n  'url',\n  'webhooks',\n  'upload',\n  'internal',\n  'deprecated',\n];\n\nfunction sortHelpGroups(helpGroups: Record<string, string[][]>): Record<string, string[][]> {\n  const groupOrder = [\n    ...new Set([\n      ...helpGroupOrder,\n      // add any others and remove duplicates\n      ...Object.keys(helpGroups),\n    ]),\n  ];\n\n  const subGroupOrder: Record<string, string[]> = {\n    core: ['init', 'start', 'start:web', 'publish', 'export'],\n  };\n\n  const sortSubGroupWithOrder = (groupName: string, group: string[][]): string[][] => {\n    const order: string[] = subGroupOrder[groupName];\n    if (!order?.length) {\n      return group;\n    }\n\n    const sortedCommands: string[][] = [];\n\n    while (order.length) {\n      const key = order.shift()!;\n      const index = group.findIndex(item => item[0].startsWith(key));\n      if (index >= 0) {\n        const [item] = group.splice(index, 1);\n        sortedCommands.push(item);\n      }\n    }\n\n    return sortedCommands.concat(group);\n  };\n\n  // Reverse the groups\n  const sortedGroups: Record<string, string[][]> = {};\n  while (groupOrder.length) {\n    const group = groupOrder.shift()!;\n    if (group in helpGroups) {\n      sortedGroups[group] = helpGroups[group];\n    }\n  }\n\n  return Object.keys(sortedGroups).reduce(\n    (prev, curr) => ({\n      ...prev,\n      // Sort subgroups that have a defined order\n      [curr]: sortSubGroupWithOrder(curr, helpGroups[curr]),\n    }),\n    {}\n  );\n}\n\n// Extended the help renderer to add a custom format and groupings.\nCommand.prototype.commandHelp = function () {\n  if (!this.commands.length) {\n    return '';\n  }\n  const width: number = this.padWidth();\n  const commands: string[][] = this.prepareCommands();\n\n  const helpGroups: Record<string, string[][]> = {};\n\n  // Sort commands into helpGroups\n  for (const command of commands) {\n    const groupName = command[2];\n    if (!helpGroups[groupName]) {\n      helpGroups[groupName] = [];\n    }\n    helpGroups[groupName].push(command);\n  }\n\n  const sorted = sortHelpGroups(helpGroups);\n\n  // Render everything.\n  return [\n    '' + chalk.bold('Commands:'),\n    '',\n    // Render all of the groups.\n    Object.values(sorted)\n      .map(group =>\n        group\n          // Render the command and description\n          .map(([cmd, description]: string[]) => {\n            // Dim the arguments that come after the command, this makes scanning a bit easier.\n            let [noArgsCmd, ...noArgsCmdArgs] = cmd.split(' ');\n            if (noArgsCmdArgs.length) {\n              noArgsCmd += ` ${chalk.dim(noArgsCmdArgs.join(' '))}`;\n            }\n\n            // Word wrap the description.\n            let wrappedDescription = description;\n            if (description) {\n              // Ensure the wrapped description appears on the same padded line.\n              wrappedDescription = '  ' + replaceAll(description, '\\n', pad('\\n', width + 3));\n            }\n\n            const paddedName = wrappedDescription ? pad(noArgsCmd, width) : noArgsCmd;\n            return paddedName + wrappedDescription;\n          })\n          .join('\\n')\n          .replace(/^/gm, '    ')\n      )\n      // Double new line to add spacing between groups\n      .join('\\n\\n'),\n    '',\n  ].join('\\n');\n};\n\nprogram.on('--help', () => {\n  Log.log(`  Run a command with --help for more info ðŸ’¡`);\n  Log.log(`    $ expo start --help`);\n  Log.log();\n});\n\nexport type Action = (...args: any[]) => void;\n\n// asyncAction is a wrapper for all commands/actions to be executed after commander is done\n// parsing the command input\nCommand.prototype.asyncAction = function (asyncFn: Action) {\n  return this.action(async (...args: any[]) => {\n    if (!getenv.boolish('EAS_BUILD', false) && !program.nonInteractive) {\n      try {\n        await profileMethod(checkCliVersionAsync)();\n      } catch {}\n    }\n\n    try {\n      const options = args[args.length - 1];\n      if (options.offline) {\n        const { ConnectionStatus } = await import('xdl');\n        ConnectionStatus.setIsOffline(true);\n      }\n\n      await asyncFn(...args);\n      // After a command, flush the analytics queue so the program will not have any active timers\n      // This allows node js to exit immediately\n      await Promise.all([Analytics.flush(), UnifiedAnalytics.flush()]);\n    } catch (err: any) {\n      // If the `--name` property is being used then we can be sure that the error is coming from `expo init`.\n      const commandName = typeof this.name === 'string' ? 'init (probably)' : this.name();\n      await handleErrorsAsync(err, { command: commandName });\n      process.exit(1);\n    }\n  });\n};\n\n// asyncActionProjectDir captures the projectDirectory from the command line,\n// setting it to cwd if it is not provided.\n// Commands such as `start` and `publish` use this.\n// It does several things:\n// - Everything in asyncAction\n// - Checks if the user is logged in or out\n// - Checks for updates\n// - Attaches the bundling logger\n// - Checks if the project directory is valid or not\n// - Runs AsyncAction with the projectDir as an argument\nCommand.prototype.asyncActionProjectDir = function (\n  asyncFn: Action,\n  options: { checkConfig?: boolean; skipSDKVersionRequirement?: boolean } = {}\n) {\n  this.option(\n    '--config [file]',\n    `${chalk.yellow('Deprecated:')} Use app.config.js to switch config files instead.`\n  );\n  return this.asyncAction(async (projectRoot: string, ...args: any[]) => {\n    const opts = args[0];\n\n    if (!projectRoot) {\n      projectRoot = process.cwd();\n    } else {\n      projectRoot = path.resolve(process.cwd(), projectRoot);\n    }\n\n    if (opts.config) {\n      Log.log(\n        chalk.yellow(\n          `\\u203A ${chalk.bold(\n            '--config'\n          )} flag is deprecated. Use app.config.js instead. ${learnMore(\n            'https://expo.fyi/config-flag-migration'\n          )}`\n        )\n      );\n      Log.newLine();\n\n      // @ts-ignore: This guards against someone passing --config without a path.\n      if (opts.config === true) {\n        Log.addNewLineIfNone();\n        Log.log('Please specify your custom config path:');\n        Log.log(chalk.green(`  expo ${this.name()} --config ${chalk.cyan(`<app-config>`)}`));\n        Log.newLine();\n        process.exit(1);\n      }\n\n      const pathToConfig = path.resolve(process.cwd(), opts.config);\n      // Warn the user when the custom config path they provided does not exist.\n      if (!fs.existsSync(pathToConfig)) {\n        const relativeInput = path.relative(process.cwd(), opts.config);\n        const formattedPath = chalk\n          .reset(pathToConfig)\n          .replace(relativeInput, chalk.bold(relativeInput));\n        Log.addNewLineIfNone();\n        Log.nestedWarn(`Custom config file does not exist:\\n${formattedPath}`);\n        Log.newLine();\n        const helpCommand = chalk.green(`expo ${this.name()} --help`);\n        Log.log(`Run ${helpCommand} for more info`);\n        Log.newLine();\n        process.exit(1);\n        // throw new Error(`File at provided config path does not exist: ${pathToConfig}`);\n      }\n      setCustomConfigPath(projectRoot, pathToConfig);\n    }\n\n    const logLines = (msg: any, logFn: (...args: any[]) => void) => {\n      if (typeof msg === 'string') {\n        for (const line of msg.split('\\n')) {\n          logFn(line);\n        }\n      } else {\n        logFn(msg);\n      }\n    };\n\n    const { INTERNAL_CALLSITES_REGEX } = await import('@expo/metro-config');\n\n    const logStackTrace = async (\n      chunk: LogRecord,\n      logFn: (...args: any[]) => void,\n      nestedLogFn: (...args: any[]) => void\n    ) => {\n      let traceInfo;\n      try {\n        traceInfo = JSON.parse(chunk.msg);\n      } catch {\n        return logFn(chunk.msg);\n      }\n\n      const { message, stack } = traceInfo;\n      Log.addNewLineIfNone();\n      logFn(chalk.bold(message));\n\n      const isLibraryFrame = (line: string) => {\n        return line.startsWith('node_modules');\n      };\n\n      const stackFrames: string[] = stack.split('\\n').filter((line: string) => line);\n      const lastAppCodeFrameIndex = findLastIndex(stackFrames, (line: string) => {\n        return !isLibraryFrame(line);\n      });\n      let lastFrameIndexToLog = Math.min(\n        stackFrames.length - 1,\n        lastAppCodeFrameIndex + 2 // show max two more frames after last app code frame\n      );\n      let unloggedFrames = stackFrames.length - lastFrameIndexToLog;\n\n      // If we're only going to exclude one frame, just log them all\n      if (unloggedFrames === 1) {\n        lastFrameIndexToLog = stackFrames.length - 1;\n        unloggedFrames = 0;\n      }\n\n      for (let i = 0; i <= lastFrameIndexToLog; i++) {\n        const line = stackFrames[i];\n\n        if (!line) {\n          continue;\n        }\n\n        let isCollapsed = false;\n        const fileNameOrUrl = matchFileNameOrURLFromStackTrace(line);\n        if (fileNameOrUrl) {\n          // Use the same regex we use in Metro config to filter out traces:\n          isCollapsed = INTERNAL_CALLSITES_REGEX.test(fileNameOrUrl);\n\n          // Unless the user is in debug mode, skip printing the collapsed files.\n          if (!Log.isDebug && isCollapsed) {\n            continue;\n          }\n        }\n\n        // If a file is collapsed, print it with dim styling.\n        const style = isCollapsed ? chalk.dim : (message: string) => message;\n        // Use the `at` prefix to match Node.js\n        nestedLogFn(style('at ' + line));\n      }\n\n      if (unloggedFrames > 0) {\n        nestedLogFn(`- ... ${unloggedFrames} more stack frames from framework internals`);\n      }\n\n      Log.printNewLineBeforeNextLog();\n    };\n\n    const logWithLevel = (chunk: LogRecord) => {\n      if (!chunk.msg) {\n        return;\n      }\n      if (chunk.level <= bunyan.INFO) {\n        if (chunk.includesStack) {\n          logStackTrace(chunk, Log.log, Log.nested);\n        } else {\n          logLines(chunk.msg, Log.log);\n        }\n      } else if (chunk.level === bunyan.WARN) {\n        if (chunk.includesStack) {\n          logStackTrace(chunk, Log.warn, Log.nestedWarn);\n        } else {\n          logLines(chunk.msg, Log.warn);\n        }\n      } else {\n        if (chunk.includesStack) {\n          logStackTrace(chunk, Log.error, Log.nestedError);\n        } else {\n          logLines(chunk.msg, Log.error);\n        }\n      }\n    };\n\n    let bar: ProgressBar | null;\n    // eslint-disable-next-line no-new\n    new PackagerLogsStream({\n      projectRoot,\n      onStartBuildBundle({ bundleDetails }) {\n        // TODO: Unify with commands/utils/progress.ts\n        const platform = PackagerLogsStream.getPlatformTagForBuildDetails(bundleDetails);\n        bar = new ProgressBar(`${platform}Bundling JavaScript [:bar] :percent`, {\n          width: 64,\n          total: 100,\n          clear: true,\n          complete: '=',\n          incomplete: ' ',\n        });\n\n        Log.setBundleProgressBar(bar);\n      },\n      onProgressBuildBundle({ progress }) {\n        if (!bar || bar.complete) return;\n        const ticks = progress - bar.curr;\n        ticks > 0 && bar.tick(ticks);\n      },\n      onFinishBuildBundle({ error, start, end, bundleDetails }) {\n        if (bar && !bar.complete) {\n          bar.tick(100 - bar.curr);\n        }\n\n        if (bar) {\n          Log.setBundleProgressBar(null);\n          bar.terminate();\n          bar = null;\n\n          const platform = PackagerLogsStream.getPlatformTagForBuildDetails(bundleDetails);\n          const totalBuildTimeMs = end.getTime() - start.getTime();\n          const durationSuffix = chalk.gray(` ${totalBuildTimeMs}ms`);\n          if (error) {\n            Log.log(chalk.red(`${platform}Bundling failed` + durationSuffix));\n          } else {\n            Log.log(chalk.green(`${platform}Bundling complete` + durationSuffix));\n            StatusEventEmitter.emit('bundleBuildFinish', { totalBuildTimeMs });\n          }\n        }\n      },\n      updateLogs: (updater: LogUpdater) => {\n        const newLogChunks = updater([]);\n        newLogChunks.forEach((newLogChunk: LogRecord) => {\n          if (newLogChunk.issueId && newLogChunk.issueCleared) {\n            return;\n          }\n          logWithLevel(newLogChunk);\n        });\n      },\n    });\n\n    // needed for validation logging to function\n    ProjectUtils.attachLoggerStream(projectRoot, {\n      stream: {\n        write: (chunk: LogRecord) => {\n          if (chunk.tag === 'device') {\n            logWithLevel(chunk);\n            StatusEventEmitter.emit('deviceLogReceive', {\n              deviceId: chunk.deviceId,\n              deviceName: chunk.deviceName,\n            });\n          }\n        },\n      },\n      type: 'raw',\n    });\n\n    // The existing CLI modules only pass one argument to this function, so skipProjectValidation\n    // will be undefined in most cases. we can explicitly pass a truthy value here to avoid\n    // validation (eg for init)\n    //\n    // If the packager/manifest server is running and healthy, there is no need\n    // to rerun Doctor because the directory was already checked previously\n    // This is relevant for command such as `send`\n    if (\n      options.checkConfig &&\n      (await ProjectSettings.getCurrentStatusAsync(projectRoot)) !== 'running'\n    ) {\n      const spinner = ora('Making sure project is set up correctly...').start();\n      Log.setSpinner(spinner);\n      // validate that this is a good projectDir before we try anything else\n\n      const { Doctor } = await import('xdl');\n      const status = await Doctor.validateWithoutNetworkAsync(projectRoot, {\n        skipSDKVersionRequirement: options.skipSDKVersionRequirement,\n      });\n      if (status === Doctor.FATAL) {\n        throw new Error(`There is an error with your project. See above logs for information.`);\n      }\n      spinner.stop();\n      Log.setSpinner(null);\n    }\n\n    // the existing CLI modules only pass one argument to this function, so skipProjectValidation\n    // will be undefined in most cases. we can explicitly pass a truthy value here to avoid validation (eg for init)\n\n    return asyncFn(projectRoot, ...args);\n  });\n};\n\nexport async function bootstrapAnalyticsAsync(): Promise<void> {\n  Analytics.initializeClient(\n    '1wHTzmVgmZvNjCalKL45chlc2VN',\n    'https://cdp.expo.dev',\n    packageJSON.version\n  );\n\n  UnifiedAnalytics.initializeClient(\n    '1wabJGd5IiuF9Q8SGlcI90v8WTs',\n    'https://cdp.expo.dev',\n    packageJSON.version\n  );\n\n  const userData = await profileMethod(\n    UserManager.getCachedUserDataAsync,\n    'getCachedUserDataAsync'\n  )();\n\n  if (!userData?.userId) return;\n\n  UnifiedAnalytics.identifyUser(userData.userId, {\n    userId: userData.userId,\n    currentConnection: userData?.currentConnection,\n    username: userData?.username,\n  });\n}\n\nexport function trackUsage(commands: Command[] = []) {\n  const input = process.argv[2];\n  const ExpoCommand = (cmd: Command): boolean =>\n    (cmd._name === input || cmd._alias === input) && input !== undefined;\n  const subCommand = commands.find(ExpoCommand)?._name;\n\n  if (!subCommand) return; // only track valid expo commands\n\n  UnifiedAnalytics.logEvent('action', {\n    action: `expo ${subCommand}`,\n    source: 'expo cli',\n    source_version: UnifiedAnalytics.version,\n  });\n}\n\nasync function runAsync(programName: string) {\n  try {\n    _registerLogs();\n\n    if (Env.shouldEnableAnalytics()) {\n      await bootstrapAnalyticsAsync();\n    }\n\n    UserManager.setInteractiveAuthenticationCallback(loginOrRegisterAsync);\n\n    if (process.env.SERVER_URL) {\n      let serverUrl = process.env.SERVER_URL;\n      if (!serverUrl.startsWith('http')) {\n        serverUrl = `http://${serverUrl}`;\n      }\n      const parsedUrl = url.parse(serverUrl);\n      const port = parseInt(parsedUrl.port || '', 10);\n      if (parsedUrl.hostname && port) {\n        Config.api.host = parsedUrl.hostname;\n        Config.api.port = port;\n      } else {\n        throw new Error('Environment variable SERVER_URL is not a valid url');\n      }\n    }\n\n    // Setup our commander instance\n    program.name(programName);\n    program\n      .version(packageJSON.version)\n      .option('--non-interactive', 'Fail, if an interactive prompt would be required to continue.');\n\n    // Load each module found in ./commands by 'registering' it with our commander instance\n    profileMethod(registerCommands)(program);\n\n    trackUsage(program.commands); // must be after register commands\n\n    program.on('command:detach', () => {\n      Log.warn('To eject your project to ExpoKit (previously \"detach\"), use `expo eject`.');\n      process.exit(0);\n    });\n\n    program.on('command:diagnostics', () => {\n      Log.warn('The `expo diagnostics` command is deprecated, use `npx expo-env-info` instead.');\n      process.exit(0);\n    });\n\n    program.on('command:*', subCommand => {\n      let msg = `\"${subCommand}\" is not an expo command. See \"expo --help\" for the full list of commands.`;\n      const availableCommands = program.commands.map((cmd: Command) => cmd._name);\n      // finding the best match whose edit distance is less than 40% of their length.\n      const suggestion = availableCommands.find(\n        (commandName: string) => leven(commandName, subCommand[0]) < commandName.length * 0.4\n      );\n      if (suggestion) {\n        msg = `\"${subCommand}\" is not an expo command -- did you mean ${suggestion}?\\n See \"expo --help\" for the full list of commands.`;\n      }\n      Log.warn(msg);\n    });\n\n    if (typeof program.nonInteractive === 'undefined') {\n      // Commander doesn't initialize boolean args with default values.\n      program.nonInteractive = !process.stdin.isTTY;\n    }\n\n    program.parse(process.argv);\n\n    // Show help when no sub-command specified\n    if (program.args.length === 0) {\n      program.help();\n    }\n  } catch (e: any) {\n    Log.error(e);\n    throw e;\n  }\n}\n\nasync function checkCliVersionAsync() {\n  // Skip checking for latest version on EAS Build\n  if (getenv.boolish('EAS_BUILD', false)) {\n    return;\n  }\n\n  const { updateIsAvailable, current, latest, deprecated } = await update.checkForUpdateAsync();\n  if (updateIsAvailable) {\n    Log.nestedWarn(\n      boxen(\n        chalk.green(`There is a new version of ${packageJSON.name} available (${latest}).\nYou are currently using ${packageJSON.name} ${current}\nInstall expo-cli globally using the package manager of your choice;\nfor example: \\`npm install -g ${packageJSON.name}\\` to get the latest version`),\n        { borderColor: 'green', padding: 1 }\n      )\n    );\n  }\n\n  if (deprecated) {\n    Log.nestedWarn(\n      boxen(\n        chalk.red(\n          `This version of expo-cli is not supported anymore.\nIt's highly recommended to update to the newest version.\n\nThe API endpoints used in this version of expo-cli might not exist,\nany interaction with Expo servers may result in unexpected behaviour.`\n        ),\n        { borderColor: 'red', padding: 1 }\n      )\n    );\n  }\n}\n\nfunction _registerLogs() {\n  const stream: bunyan.Stream = {\n    level: Log.isDebug ? 'debug' : 'info',\n    stream: {\n      write: (chunk: any) => {\n        if (chunk.code) {\n          switch (chunk.code) {\n            case LoadingEvent.START_PROGRESS_BAR: {\n              const bar = new ProgressBar(chunk.msg, {\n                width: 64,\n                total: 100,\n                clear: true,\n                complete: '=',\n                incomplete: ' ',\n              });\n              Log.setBundleProgressBar(bar);\n              return;\n            }\n            case LoadingEvent.TICK_PROGRESS_BAR: {\n              const bar = Log.getProgress();\n              if (bar) {\n                bar.tick(1, chunk.msg);\n              }\n              return;\n            }\n            case LoadingEvent.STOP_PROGRESS_BAR: {\n              const bar = Log.getProgress();\n              if (bar) {\n                Log.setBundleProgressBar(null);\n                bar.terminate();\n              }\n              return;\n            }\n            case LoadingEvent.START_LOADING:\n              logNewSection(chunk.msg || '');\n              return;\n            case LoadingEvent.STOP_LOADING: {\n              const spinner = Log.getSpinner();\n              if (spinner) {\n                spinner.stop();\n              }\n              return;\n            }\n          }\n        }\n\n        if (chunk.level === bunyan.INFO) {\n          Log.log(chunk.msg);\n        } else if (chunk.level === bunyan.WARN) {\n          Log.warn(chunk.msg);\n        } else if (chunk.level === bunyan.DEBUG) {\n          Log.debug(chunk.msg);\n        } else if (chunk.level >= bunyan.ERROR) {\n          Log.error(chunk.msg);\n        }\n      },\n    },\n    type: 'raw',\n  };\n\n  Logger.notifications.addStream(stream);\n  Logger.global.addStream(stream);\n}\n\nasync function writePathAsync() {\n  const subCommand = process.argv[2];\n  if (subCommand === 'prepare-detached-build') {\n    // This is being run from Android Studio or Xcode. Don't want to write PATH in this case.\n    return;\n  }\n\n  await Binaries.writePathToUserSettingsAsync();\n}\n\n// This is the entry point of the CLI\nexport function run(programName: string) {\n  (async function () {\n    await Promise.all([writePathAsync(), runAsync(programName)]);\n  })().catch(e => {\n    Log.error('Uncaught Error', e);\n    process.exit(1);\n  });\n}\n"],"mappings":"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"}