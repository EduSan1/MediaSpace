{"version":3,"file":"convertHTMLToASCII.js","names":["turndownServices","getService","rootUrl","turndownService","TurndownService","addRule","filter","replacement","content","chalk","strikethrough","bold","italic","node","options","linkStyle","nodeName","getAttribute","href","startsWith","terminalLink","isSupported","cyan","underline","convertHTMLToASCII","service","wrapAnsi","turndown","process","stdout","columns"],"sources":["../../src/appleApi/convertHTMLToASCII.ts"],"sourcesContent":["import chalk from 'chalk';\nimport terminalLink from 'terminal-link';\n// @ts-ignore\nimport TurndownService from 'turndown';\nimport wrapAnsi from 'wrap-ansi';\n\nconst turndownServices: Record<string, any> = {};\n\nfunction getService(rootUrl: string) {\n  if (turndownServices[rootUrl]) {\n    return turndownServices[rootUrl];\n  }\n  const turndownService = new TurndownService();\n  turndownService.addRule('strikethrough', {\n    filter: ['del', 's', 'strike'],\n    replacement(content: string): string {\n      return chalk.strikethrough(content);\n    },\n  });\n  turndownService.addRule('strong', {\n    filter: ['strong', 'b'],\n    replacement(content: string): string {\n      return chalk.bold(content);\n    },\n  });\n  turndownService.addRule('emphasis', {\n    filter: ['em', 'i'],\n    replacement(content: string): string {\n      return chalk.italic(content);\n    },\n  });\n  turndownService.addRule('heading', {\n    filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    replacement(content: string): string {\n      return '\\n' + chalk.bold(content) + '\\n';\n    },\n  });\n  turndownService.addRule('inlineLink', {\n    filter(node: any, options: any) {\n      return options.linkStyle === 'inlined' && node.nodeName === 'A' && node.getAttribute('href');\n    },\n    replacement(content: string, node: any) {\n      let href = node.getAttribute('href');\n      if (href.startsWith('/')) href = `${rootUrl}${href}`;\n      if (terminalLink.isSupported) {\n        return chalk.cyan(terminalLink(content, href));\n      }\n      return `${chalk.cyan(content)} (${chalk.underline(href)})`;\n    },\n  });\n\n  turndownServices[rootUrl] = turndownService;\n  return turndownService;\n}\n\nexport function convertHTMLToASCII({\n  content,\n  rootUrl,\n}: {\n  content: string;\n  rootUrl: string;\n}): string {\n  const service = getService(rootUrl);\n  return wrapAnsi(service.turndown(content), process.stdout.columns || 80);\n}\n"],"mappings":"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"}