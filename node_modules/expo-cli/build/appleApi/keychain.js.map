{"version":3,"file":"keychain.js","names":["KEYCHAIN_TYPE","IS_MAC","process","platform","NO_PASSWORD_REGEX","EXPO_NO_KEYCHAIN","getenv","boolish","deletePasswordAsync","username","serviceName","Promise","resolve","reject","keychain","deletePassword","account","service","type","error","message","match","getPasswordAsync","getPassword","password","setPasswordAsync","setPassword"],"sources":["../../src/appleApi/keychain.ts"],"sourcesContent":["import getenv from 'getenv';\n// @ts-ignore\nimport keychain from 'keychain';\n\nconst KEYCHAIN_TYPE = 'internet';\nconst IS_MAC = process.platform === 'darwin';\nconst NO_PASSWORD_REGEX = /Could not find password/;\n\n// When enabled, the password will not only be skipped but also deleted.\n// This makes it easier to completely opt-out of Keychain functionality.\nexport const EXPO_NO_KEYCHAIN = getenv.boolish('EXPO_NO_KEYCHAIN', false);\n\ntype Credentials = {\n  serviceName: string;\n  username: string;\n  password: string;\n};\n\nexport function deletePasswordAsync({\n  username,\n  serviceName,\n}: Pick<Credentials, 'username' | 'serviceName'>): Promise<boolean> {\n  if (!IS_MAC) {\n    return Promise.resolve(false);\n  }\n\n  return new Promise((resolve, reject) => {\n    keychain.deletePassword(\n      { account: username, service: serviceName, type: KEYCHAIN_TYPE },\n      (error: Error) => {\n        if (error) {\n          if (error.message.match(NO_PASSWORD_REGEX)) {\n            return resolve(false);\n          }\n          reject(error);\n        } else {\n          resolve(true);\n        }\n      }\n    );\n  });\n}\n\nexport function getPasswordAsync({\n  username,\n  serviceName,\n}: Pick<Credentials, 'serviceName' | 'username'>): Promise<string | null> {\n  if (!IS_MAC) {\n    return Promise.resolve(null);\n  }\n\n  return new Promise((resolve, reject) => {\n    keychain.getPassword(\n      { account: username, service: serviceName, type: KEYCHAIN_TYPE },\n      (error: Error, password: string) => {\n        if (error) {\n          if (error.message.match(NO_PASSWORD_REGEX)) {\n            return resolve(null);\n          }\n          reject(error);\n        } else {\n          resolve(password);\n        }\n      }\n    );\n  });\n}\n\nexport function setPasswordAsync({\n  serviceName,\n  username,\n  password,\n}: Credentials): Promise<boolean> {\n  if (!IS_MAC) {\n    return Promise.resolve(false);\n  }\n  return new Promise((resolve, reject) => {\n    keychain.setPassword(\n      { account: username, service: serviceName, password, type: KEYCHAIN_TYPE },\n      (error: Error) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve(true);\n        }\n      }\n    );\n  });\n}\n"],"mappings":";;;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AADA;AAGA,MAAMA,aAAa,GAAG,UAAtB;AACA,MAAMC,MAAM,GAAGC,OAAO,CAACC,QAAR,KAAqB,QAApC;AACA,MAAMC,iBAAiB,GAAG,yBAA1B,C,CAEA;AACA;;AACO,MAAMC,gBAAgB,GAAGC,iBAAA,CAAOC,OAAP,CAAe,kBAAf,EAAmC,KAAnC,CAAzB;;;;AAQA,SAASC,mBAAT,CAA6B;EAClCC,QADkC;EAElCC;AAFkC,CAA7B,EAG6D;EAClE,IAAI,CAACT,MAAL,EAAa;IACX,OAAOU,OAAO,CAACC,OAAR,CAAgB,KAAhB,CAAP;EACD;;EAED,OAAO,IAAID,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCC,mBAAA,CAASC,cAAT,CACE;MAAEC,OAAO,EAAEP,QAAX;MAAqBQ,OAAO,EAAEP,WAA9B;MAA2CQ,IAAI,EAAElB;IAAjD,CADF,EAEGmB,KAAD,IAAkB;MAChB,IAAIA,KAAJ,EAAW;QACT,IAAIA,KAAK,CAACC,OAAN,CAAcC,KAAd,CAAoBjB,iBAApB,CAAJ,EAA4C;UAC1C,OAAOQ,OAAO,CAAC,KAAD,CAAd;QACD;;QACDC,MAAM,CAACM,KAAD,CAAN;MACD,CALD,MAKO;QACLP,OAAO,CAAC,IAAD,CAAP;MACD;IACF,CAXH;EAaD,CAdM,CAAP;AAeD;;AAEM,SAASU,gBAAT,CAA0B;EAC/Bb,QAD+B;EAE/BC;AAF+B,CAA1B,EAGmE;EACxE,IAAI,CAACT,MAAL,EAAa;IACX,OAAOU,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;EACD;;EAED,OAAO,IAAID,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCC,mBAAA,CAASS,WAAT,CACE;MAAEP,OAAO,EAAEP,QAAX;MAAqBQ,OAAO,EAAEP,WAA9B;MAA2CQ,IAAI,EAAElB;IAAjD,CADF,EAEE,CAACmB,KAAD,EAAeK,QAAf,KAAoC;MAClC,IAAIL,KAAJ,EAAW;QACT,IAAIA,KAAK,CAACC,OAAN,CAAcC,KAAd,CAAoBjB,iBAApB,CAAJ,EAA4C;UAC1C,OAAOQ,OAAO,CAAC,IAAD,CAAd;QACD;;QACDC,MAAM,CAACM,KAAD,CAAN;MACD,CALD,MAKO;QACLP,OAAO,CAACY,QAAD,CAAP;MACD;IACF,CAXH;EAaD,CAdM,CAAP;AAeD;;AAEM,SAASC,gBAAT,CAA0B;EAC/Bf,WAD+B;EAE/BD,QAF+B;EAG/Be;AAH+B,CAA1B,EAI2B;EAChC,IAAI,CAACvB,MAAL,EAAa;IACX,OAAOU,OAAO,CAACC,OAAR,CAAgB,KAAhB,CAAP;EACD;;EACD,OAAO,IAAID,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCC,mBAAA,CAASY,WAAT,CACE;MAAEV,OAAO,EAAEP,QAAX;MAAqBQ,OAAO,EAAEP,WAA9B;MAA2Cc,QAA3C;MAAqDN,IAAI,EAAElB;IAA3D,CADF,EAEGmB,KAAD,IAAkB;MAChB,IAAIA,KAAJ,EAAW;QACTN,MAAM,CAACM,KAAD,CAAN;MACD,CAFD,MAEO;QACLP,OAAO,CAAC,IAAD,CAAP;MACD;IACF,CARH;EAUD,CAXM,CAAP;AAYD"}